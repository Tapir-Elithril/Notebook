
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tapir's Notebook">
      
      
        <meta name="author" content="杨亿酬">
      
      
        <link rel="canonical" href="https://tapir-elithril.github.io/Notebook/sp25/sys3/note/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../db/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>笔记 - Tapir's Notebook</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#iii" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Tapir&#39;s Notebook" class="md-header__button md-logo" aria-label="Tapir's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tapir's Notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              笔记
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="orange"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="orange"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Tapir-Elithril/Notebook" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Tapir-Elithril/Notebook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tools/" class="md-tabs__link">
          
  
  
    
  
  tools

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../fa23/" class="md-tabs__link">
          
  
  
    
  
  fa23

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../sp24/" class="md-tabs__link">
          
  
  
    
  
  sp24

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../fa24/" class="md-tabs__link">
          
  
  
    
  
  fa24

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  sp25

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../fa25/" class="md-tabs__link">
          
  
  
    
  
  fa25

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../research/data/note/" class="md-tabs__link">
          
  
  
    
  
  research

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Tapir&#39;s Notebook" class="md-nav__button md-logo" aria-label="Tapir's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Tapir's Notebook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Tapir-Elithril/Notebook" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Tapir-Elithril/Notebook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    tools
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/markdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Markdown
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tools/latex/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    LaTeX
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    LaTeX
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/latex/format/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    文献
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/latex/symbols/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常用符号
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/makefile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Makefile
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa23/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    fa23
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    fa23
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/military_training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    军训
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/math_analysis1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数学分析(甲)I(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    程序设计与算法基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/linear_algebra1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    线性代数I(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/modern_history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中国近现代史纲要(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/morality_law/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    思想道德与法治
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/political_philosophy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    近代西方政治哲学导论
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/astronomy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    天文学导论
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/psychology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    心理学及应用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/career_planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    职业生涯规划
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/reform_and_openup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中国改革开放史
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/orienteering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    定向越野
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa23/fitness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    身体素质课
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../sp24/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    sp24
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    sp24
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/math_analysis2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数学分析(甲)II(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../sp24/sys1/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    计算机系统I
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    计算机系统I
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/sys1/CPU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    单周期CPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/physics1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    普通物理学I(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/discrete_math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    离散数学理论基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/linear_algebra2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    线性代数II(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../sp24/fds/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    数据结构基础
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据结构基础
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/fds/struct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常见结构体
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/physics1_lab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    普通物理学实验I
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/cyber_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网络空间安全导论
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/piano/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    打开艺术之门——钢琴
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/swimming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    游泳(初级)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/fitness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    身体素质课
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/situation_policy1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    形势与政策I
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sp24/ctf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    课程综合实践I——安全攻防实践基础(CTF)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa24/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    fa24
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    fa24
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa24/sys2/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    计算机系统II
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    计算机系统II
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/sys2/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    课程笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/physics2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    普通物理学II(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa24/ads/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    高级数据结构与算法分析
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    高级数据结构与算法分析
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/ads/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    课程笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/probability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概率论(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/aid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    人工智能引论
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/military_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    军事理论
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/physics2_lab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    普通物理学实验II
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/tea/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    茶文化与茶健康
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa24/aerobics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    健美操
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    sp25
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    sp25
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    计算机系统III
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    计算机系统III
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        体系结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="体系结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fundamentals-of-computer-system-week1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fundamentals of computer system Week1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fundamentals of computer system Week1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quantitative-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        系统量化研究方法 Quantitative approach
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amdahls-law" class="md-nav__link">
    <span class="md-ellipsis">
      
        Amdahl's Law(性能优化)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#great-architecture-ideas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Great Architecture Ideas
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instruction-level-parallelismilp-week2-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Instruction-Level Parallelism(ILP) Week2 - 3
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instruction-Level Parallelism(ILP) Week2 - 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#branch-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Branch prediction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Scheduling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-based-speculation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardware-Based Speculation 硬件前瞻
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-ilp-using-multiple-issue-and-static-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exploiting ILP Using Multiple Issue and Static Scheduling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-hierarchycache-week4-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Hierarchy(Cache) Week4 - 5
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Hierarchy(Cache) Week4 - 5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technology-trend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technology Trend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Hierarchy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-system-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory System Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu-vulnerability" class="md-nav__link">
    <span class="md-ellipsis">
      
        *CPU Vulnerability
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-optimization-presentation-week-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Optimization presentation Week 6
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#os" class="md-nav__link">
    <span class="md-ellipsis">
      
        OS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-memory-week7-10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main Memory Week7 - 10
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Main Memory Week7 - 10">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segmentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Paging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-memory_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#free-space-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        *Free Space Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-week10-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System Week10 - 12
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File System Week10 - 12">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-system-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        File structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acl" class="md-nav__link">
    <span class="md-ellipsis">
      
        ACL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-and-directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        File and Directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crash-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        *Crash Consistency
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mass-storage-week13" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mass Storage Week13
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mass Storage Week13">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magnetic-disk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Magnetic Disk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-volatile-memory-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Non-volatile memory devices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-attachment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk Attachment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk scheduling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-week13-14" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O Week13 - 14
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="I/O Week13 - 14">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#io-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O hardware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interrupts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interrupts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dma" class="md-nav__link">
    <span class="md-ellipsis">
      
        DMA
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O Devices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-io-subsystem" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kernel I/O Subsystem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Page Cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        体系结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="体系结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dlptlp-week14-15" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLP,TLP Week14 - 15
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DLP,TLP Week14 - 15">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simdvector-processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        SIMD:Vector processor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Array Processor阵列机
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dlp-in-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLP in GPU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llp" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimdthread-level-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      
        MIMD:Thread-level Parallelism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-evalutation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance evalutation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-coherence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Coherence
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-review-week16" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final Review Week16
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Final Review Week16">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        体系结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="体系结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        量化研究方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ilp" class="md-nav__link">
    <span class="md-ellipsis">
      
        ILP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-issue-static-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple issue &amp; static scheduling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dlp" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tlp" class="md-nav__link">
    <span class="md-ellipsis">
      
        TLP
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#os_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        OS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mass-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mass Storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../db/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    数据库系统
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据库系统
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../db/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../oop/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    面向对象程序设计
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    面向对象程序设计
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oop/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../marx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    马克思主义基本原理(H)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../xi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    习近平新时代中国特色社会主义思想概论
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../line_dance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    排舞
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_market/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    数据要素交易基础
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据要素交易基础
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_market/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa25/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    fa25
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    fa25
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa25/ml/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    机器学习
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    机器学习
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa25/ml/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa25/icv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    计算机视觉导论
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    计算机视觉导论
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa25/icv/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa25/tcs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    理论计算机科学导引
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa25/opt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    优化基本理论与方法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../fa25/quantum/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    量子计算理论基础与软件系统
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    量子计算理论基础与软件系统
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa25/quantum/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa25/mao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    毛泽东思想与中国特色社会主义理论体系概论（H）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fa25/tennis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网球（初级）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    research
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    research
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    data_target
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    data_target
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/data/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Target
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/data/paper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    paper_list
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/data/review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    review
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../research/kaggle/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    kaggle
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    kaggle
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    llm_infra
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    llm_infra
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/llm_vuln/kvcache/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kvcache
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/llm_vuln/llm_vulnerability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    llm_vulnerability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/llm_vuln/mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    mcp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        体系结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="体系结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fundamentals-of-computer-system-week1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fundamentals of computer system Week1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fundamentals of computer system Week1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quantitative-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        系统量化研究方法 Quantitative approach
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amdahls-law" class="md-nav__link">
    <span class="md-ellipsis">
      
        Amdahl's Law(性能优化)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#great-architecture-ideas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Great Architecture Ideas
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instruction-level-parallelismilp-week2-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Instruction-Level Parallelism(ILP) Week2 - 3
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instruction-Level Parallelism(ILP) Week2 - 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#branch-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Branch prediction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Scheduling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-based-speculation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardware-Based Speculation 硬件前瞻
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-ilp-using-multiple-issue-and-static-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exploiting ILP Using Multiple Issue and Static Scheduling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-hierarchycache-week4-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Hierarchy(Cache) Week4 - 5
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Hierarchy(Cache) Week4 - 5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technology-trend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technology Trend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Hierarchy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-system-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory System Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu-vulnerability" class="md-nav__link">
    <span class="md-ellipsis">
      
        *CPU Vulnerability
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-optimization-presentation-week-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Optimization presentation Week 6
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#os" class="md-nav__link">
    <span class="md-ellipsis">
      
        OS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-memory-week7-10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main Memory Week7 - 10
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Main Memory Week7 - 10">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segmentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Paging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-memory_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#free-space-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        *Free Space Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-week10-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System Week10 - 12
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File System Week10 - 12">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-system-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        File structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acl" class="md-nav__link">
    <span class="md-ellipsis">
      
        ACL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-and-directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        File and Directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crash-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        *Crash Consistency
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mass-storage-week13" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mass Storage Week13
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mass Storage Week13">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#magnetic-disk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Magnetic Disk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-volatile-memory-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Non-volatile memory devices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-attachment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk Attachment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk scheduling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-week13-14" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O Week13 - 14
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="I/O Week13 - 14">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#io-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O hardware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interrupts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interrupts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dma" class="md-nav__link">
    <span class="md-ellipsis">
      
        DMA
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O Devices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-io-subsystem" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kernel I/O Subsystem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Page Cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        体系结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="体系结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dlptlp-week14-15" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLP,TLP Week14 - 15
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DLP,TLP Week14 - 15">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simdvector-processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        SIMD:Vector processor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Array Processor阵列机
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dlp-in-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLP in GPU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llp" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimdthread-level-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      
        MIMD:Thread-level Parallelism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-evalutation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance evalutation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-coherence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Coherence
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-review-week16" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final Review Week16
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Final Review Week16">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        体系结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="体系结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        量化研究方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ilp" class="md-nav__link">
    <span class="md-ellipsis">
      
        ILP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-issue-static-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple issue &amp; static scheduling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dlp" class="md-nav__link">
    <span class="md-ellipsis">
      
        DLP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tlp" class="md-nav__link">
    <span class="md-ellipsis">
      
        TLP
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#os_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        OS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mass-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mass Storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        File System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Tapir-Elithril/Notebook/edit/main/docs/sp25/sys3/note.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="iii">计算机系统III<a class="headerlink" href="#iii" title="Permanent link">&para;</a></h1>
<p>体系结构 by Rui Chang<br />
OS by Yajin Zhou  </p>
<h2 id="_1">体系结构<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="fundamentals-of-computer-system-week1">Fundamentals of computer system Week1<a class="headerlink" href="#fundamentals-of-computer-system-week1" title="Permanent link">&para;</a></h3>
<p>Classes of computers(by Flynn)  </p>
<ul>
<li>SISD(single instruction single data stream):only in theory  </li>
<li>SIMD(multiple):commonly used  </li>
<li>MISD:only in theory  </li>
<li>MIMD:current CPU  </li>
</ul>
<p>Classes of computers(in textbook)  </p>
<ul>
<li>desktop/personal  </li>
<li>server:服务器 security  </li>
<li>embedded:嵌入式 immediate response  </li>
<li>personal mobile  </li>
<li>supercomputer(peak performance + electricity -&gt; cooling)  </li>
</ul>
<p><strong>Performance</strong><br />
The performance(time) can be affected by:  </p>
<ul>
<li>Algorithm(time complexity)  </li>
<li>Programming language,compiler,architecture  </li>
<li>Processor and memory  </li>
<li>I/O,OS  </li>
</ul>
<p><strong>Measuring performance</strong><br />
- Single users on a PC<br />
    minimization of response time <br />
    minimization of execution time<br />
- Large data<br />
    maximization of TP<br />
- Response time<br />
- Execution time(CPU time)<br />
    comprises of user CPU (execution) time and system CPU time  </p>
<p><span class="arithmatex">\(Performance = \frac{1}{Execution Time}\)</span><br />
If X is <em>n</em> times faster than Y,then <span class="arithmatex">\(\frac{Performance_X}{Performance_Y} = \frac{Execution Time_Y}{Execution Time_X} = n\)</span></p>
<h4 id="quantitative-approach">系统量化研究方法 Quantitative approach<a class="headerlink" href="#quantitative-approach" title="Permanent link">&para;</a></h4>
<p><strong>CPU Performance</strong> 
<span class="arithmatex">\(CPU\ Execution\ Time = CPU\ Clock\ Cycles * Clock\ Period\)</span><br />
<span class="arithmatex">\(CPU\ Execution\ Time = \frac{CPU\ Clock\ Cycles}{Clock\ Rate(freq)}\)</span><br />
Performance improvement by  </p>
<ul>
<li>reduce number of clock cycles  </li>
<li>increase clock rate  </li>
<li>trade off clock rate against cycle count  </li>
</ul>
<p>Average cycles per instruction(CPI)<br />
<span class="arithmatex">\(CPI = \frac{CPU\ Clock\ Cycles}{Instruction\ Count}\)</span><br />
<img alt="alt text" src="../image.png" /><br />
<span class="arithmatex">\(CPU\ time = \frac{Instructions}{Program}*\frac{Clock\ Cycles}{Instructions}*\frac{Seconds}{Clock\ Cycles}\)</span>  </p>
<h4 id="amdahls-law">Amdahl's Law(性能优化)<a class="headerlink" href="#amdahls-law" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\(Improved\ Execution\ Time = \frac{Affected\ Execution\ Time}{Amount\ of\ Improvement} + Unaffected\ Execution\ Time\)</span><br />
<span class="arithmatex">\(T_{improved}=\frac{T_{affected}}{improvement\ factor} + T_{unaffected}\)</span>  </p>
<p>局部加速比:improvement factor<br />
<span class="arithmatex">\(Speedup_{overall} = \frac{Performance\ for\ entire\ task_{using\ enhancement}}{Performance\ for\ entire\ task_{without\ enhancement}}= \frac{Total\ Execution\ Time_{without\ enhancement}}{Total\ Execution\ Time_{using\ enhancement}}\)</span>  </p>
<p>改进比例:<span class="arithmatex">\(fraction = \frac{Time\ can\ be\ improved}{Total\ Execution\ Time}\)</span> 
<img alt="alt text" src="../image-1.png" />
<span class="arithmatex">\(Speedup_{overall} &lt; \frac{1}{1-Fraction_{enhanced}}\)</span></p>
<h4 id="great-architecture-ideas">Great Architecture Ideas<a class="headerlink" href="#great-architecture-ideas" title="Permanent link">&para;</a></h4>
<ul>
<li>Moore's law:number of transistors doubles every 18-24 months  </li>
<li>Use abstraction to simplify design  </li>
<li>Make the common case fast  </li>
<li>Improve performance via parallelism  </li>
<li>Improve performance via pipelining  </li>
<li>Improve performance via prediction  </li>
<li>Use a hierarchy(分级) of memories  </li>
<li>Improve dependability(可靠性) via redundancy(备份)  </li>
</ul>
<p>Below the program:  </p>
<ul>
<li>parallel nature of processors  </li>
<li>hierarchical nature of memories  </li>
<li>compiler decisions  </li>
</ul>
<h3 id="instruction-level-parallelismilp-week2-3">Instruction-Level Parallelism(ILP) Week2 - 3<a class="headerlink" href="#instruction-level-parallelismilp-week2-3" title="Permanent link">&para;</a></h3>
<p>Dependencies  </p>
<ul>
<li>Data dependence(RAW-read after write)</li>
<li>Name dependence:rename
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">DIV</span><span class="w"> </span><span class="no">F2</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F4</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nf">ADD</span><span class="w"> </span><span class="no">F6</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F12</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nf">SUB</span><span class="w"> </span><span class="no">F8</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F14</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1">//anti-dependence(WAR)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nf">DIV</span><span class="w"> </span><span class="no">F2</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F4</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nf">ADD</span><span class="w"> </span><span class="no">S</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F12</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nf">SUB</span><span class="w"> </span><span class="no">F8</span><span class="p">,</span><span class="no">S</span><span class="p">,</span><span class="no">F14</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nf">DIV</span><span class="w"> </span><span class="no">F2</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F4</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nf">ADD</span><span class="w"> </span><span class="no">F6</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F12</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nf">SUB</span><span class="w"> </span><span class="no">F2</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F14</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1">//output-dependence(WAW)</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nf">DIV</span><span class="w"> </span><span class="no">F2</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F4</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="nf">ADD</span><span class="w"> </span><span class="no">F6</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F12</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="nf">SUB</span><span class="w"> </span><span class="no">S</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F14</span>
</code></pre></div></li>
<li>Control dependence:Branch hazards  </li>
</ul>
<p><img alt="alt text" src="../image-3.png" />  </p>
<p>Hazard  </p>
<ul>
<li>Structure hazard:add hardware</li>
<li>Data hazard:Forwarding + stall/scheduling  </li>
<li>Control hazard:branch prediction  </li>
</ul>
<h4 id="branch-prediction">Branch prediction<a class="headerlink" href="#branch-prediction" title="Permanent link">&para;</a></h4>
<ul>
<li>static:任选</li>
<li>dynamic:BTB</li>
</ul>
<p>Delay slot:forbidden by RISC-V due to prediction  </p>
<p>Dynamic branch prediction<br />
1.Branch History Table(BHT):2-Bit predictor<br />
2.Instruction/Data-read/Data-write buffer(Branch-Target Buffer(BTB) in prediction)<br />
<img alt="alt text" src="../image-2.png" />  </p>
<h4 id="dynamic-scheduling">Dynamic Scheduling<a class="headerlink" href="#dynamic-scheduling" title="Permanent link">&para;</a></h4>
<p>simple pipelining has the limitation:  </p>
<p>In-order
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nf">DIV</span><span class="w"> </span><span class="no">F4</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F2</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nf">SUB</span><span class="w"> </span><span class="no">F10</span><span class="p">,</span><span class="no">F4</span><span class="p">,</span><span class="no">F6</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nf">ADD</span><span class="w"> </span><span class="no">F12</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F14</span><span class="c1">//waiting without data dependencies</span>
</code></pre></div></p>
<h5 id="scoreboard">Scoreboard<a class="headerlink" href="#scoreboard" title="Permanent link">&para;</a></h5>
<p>Scoreboard algorithm is an approach to schedule the instructions.  </p>
<p>recall:hazard detection in ID<br />
split ID into two parts:IS(issue) &amp; RO(read operands)<br />
IS:check structural hazards(in-order)<br />
RO:check data hazards(out of order)<br />
cannot flow to IS/RO if a certain hazard exists<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="err">1</span><span class="na">.LD</span><span class="w">  </span><span class="no">F6</span><span class="p">,</span><span class="mi">34</span><span class="p">(</span><span class="no">R2</span><span class="p">)</span><span class="w"> </span><span class="c1">//integer unit</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1">//assume the first inst has been completed</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="err">2</span><span class="na">.LD</span><span class="w">  </span><span class="no">F2</span><span class="p">,</span><span class="mi">45</span><span class="p">(</span><span class="no">R3</span><span class="p">)</span><span class="w"> </span><span class="c1">//integer unit structural hazard</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="err">3</span><span class="na">.MUL</span><span class="w"> </span><span class="no">F0</span><span class="p">,</span><span class="no">F2</span><span class="p">,</span><span class="no">F4</span><span class="w">  </span><span class="c1">//F2 F8 F0 F6 data hazard</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="err">4</span><span class="na">.SUB</span><span class="w"> </span><span class="no">F8</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F2</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="err">5</span><span class="na">.DIV</span><span class="w"> </span><span class="no">F10</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F6</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="err">6</span><span class="na">.ADD</span><span class="w"> </span><span class="no">F6</span><span class="p">,</span><span class="no">F8</span><span class="p">,</span><span class="no">F2</span>
</code></pre></div></p>
<p>info table design  </p>
<ul>
<li>Instruction status table<br />
<img alt="alt text" src="../image-5.png" /></li>
<li>Function component status table<br />
<img alt="alt text" src="../image-7.png" />
只有在某条指令执行WB后清空该指令使用的部件的一行，下一个要使用这一部件的指令才能进入IS阶段  </li>
<li>Register status table
<img alt="alt text" src="../image-8.png" />
note that register status can be read from function component table,register status table is created just for convenience.  </li>
</ul>
<p>In-class practice:
<img alt="alt text" src="../bfe71aabcb33516540fb13d8f421b2f.jpg" /></p>
<h5 id="tomasulo">Tomasulo<a class="headerlink" href="#tomasulo" title="Permanent link">&para;</a></h5>
<p>Tomasulo's approach is to introduce <strong>register renaming</strong> in hardware to minimize WAW and WAR hazards.<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="err">1</span><span class="na">.LD</span><span class="w">  </span><span class="no">F6</span><span class="p">,</span><span class="mi">34</span><span class="p">(</span><span class="no">R2</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="mi">2</span><span class="no">.LD</span><span class="w">  </span><span class="no">F2</span><span class="p">,</span><span class="mi">45</span><span class="p">(</span><span class="no">R3</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="mi">3</span><span class="no">.MUL</span><span class="w"> </span><span class="no">F0</span><span class="p">,</span><span class="no">F2</span><span class="p">,</span><span class="no">F4</span><span class="w">  </span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="mi">4</span><span class="no">.SUB</span><span class="w"> </span><span class="no">F8</span><span class="p">,</span><span class="no">F6</span><span class="p">,</span><span class="no">F2</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="err">5</span><span class="na">.DIV</span><span class="w"> </span><span class="no">F10</span><span class="p">,</span><span class="no">F0</span><span class="p">,</span><span class="no">F6</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="err">6</span><span class="na">.ADD</span><span class="w"> </span><span class="no">F6</span><span class="p">,</span><span class="no">F8</span><span class="p">,</span><span class="no">F2</span>
</code></pre></div>
Reservation Station(RS保留站):防止因硬件冲突导致指令无法流入(上例中的4.SUB与6.ADD),在RS中执行乱序<br />
Command Data Bus(CDB):将指令需要的值替换为保留站的结果(6.ADD中F8的值即为adder RS的结果,保留站的名称替代了寄存器的名称),通过广播的方式使结果分布控制<br />
执行阶段简化为IS,EX,WB三阶段,没有解决顺序写回的问题<br />
IS:检查保留站是否还有空位 
EX:保留站中乱序执行,如果操作数未全部ready则等待,操作数已经ready的先执行<br />
WB:CDB同时将结果写入寄存器和需要的RS<br />
Register status Qi记录寄存器与RS的对应关系<br />
Instruction status table,Function component status table,Register status table(Field Qi) are still needed.</p>
<p>Limitation:</p>
<ul>
<li>Structual complexity  </li>
<li>performance limited by Common Data Bus  </li>
<li>correctness not guaranteed  </li>
</ul>
<p>The limitations on ILP approaches directly led to the movement to multicore.</p>
<p>In-class practice:
<img alt="alt text" src="../73594853addbe984fa7f1755da7374b.png" /></p>
<p>Instructions come out in order:Waiting sofa(buffer)</p>
<h4 id="hardware-based-speculation">Hardware-Based Speculation 硬件前瞻<a class="headerlink" href="#hardware-based-speculation" title="Permanent link">&para;</a></h4>
<p>Reorder buffer(ROB) before writing back to registers<br />
Why reorder?<br />
For debug and consistency<br />
extend the stages of every instruction into:IS,EX,WB,Commit<br />
Commit:In-order write back —— the key of speculation  </p>
<ul>
<li>Function component status table:ROB No. in column dest in  </li>
<li>ROB table:the current stages of the relevant instructions  </li>
<li>Register status table:ROB row shows the registers to be written and the corresponding ROB No.</li>
</ul>
<p>In-class practice:前三列同Tomasulo<br />
Commit列:5,6,17,18,58,59  </p>
<div class="admonition danger">
<p class="admonition-title">60个周期的表格变化，每个格子会填会算</p>
</div>
<ul>
<li>Precise exception  </li>
<li>easily extend to other(e.g. integer)units  </li>
<li>complex hardware(CDB)  </li>
</ul>
<h4 id="exploiting-ilp-using-multiple-issue-and-static-scheduling">Exploiting ILP Using Multiple Issue and Static Scheduling<a class="headerlink" href="#exploiting-ilp-using-multiple-issue-and-static-scheduling" title="Permanent link">&para;</a></h4>
<ul>
<li>n-issue Superscalar  </li>
<li>VLIW  </li>
<li>Super pipeline  </li>
</ul>
<p>Dynamic scheduling is more dependent on hardware,while static scheduling may not.  </p>
<p>Multi-issue based on dynamic scheduling:
双流入流出Tomasulo:<br />
<img alt="alt text" src="../image-9.png" /><br />
bottleneck:data-dependent branches &amp; ALU
With Speculation:<br />
<img alt="alt text" src="../image-10.png" /><br />
前瞻执行：不需要等待分支结果，因为不一定要提交<br />
Branches are a critical performance limiter(especially with data-dependent ones),but speculation helps.  </p>
<h5 id="vliw">VLIW<a class="headerlink" href="#vliw" title="Permanent link">&para;</a></h5>
<p>operation slots<br />
parallel execution in EX<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nl">Loop:</span><span class="nf">fld</span><span class="w">    </span><span class="no">f0</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="no">x1</span><span class="p">)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">     </span><span class="nf">fadd.d</span><span class="w"> </span><span class="no">f4</span><span class="p">,</span><span class="no">f0</span><span class="p">,</span><span class="no">f2</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">     </span><span class="nf">fsd</span><span class="w">    </span><span class="no">f4</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="no">x1</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">     </span><span class="nf">addi</span><span class="w">   </span><span class="no">x1</span><span class="p">,</span><span class="no">x1</span><span class="p">,-</span><span class="mi">8</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">     </span><span class="nf">bne</span><span class="w">    </span><span class="no">x1</span><span class="p">,</span><span class="no">x2</span><span class="p">,</span><span class="no">Loop</span>
</code></pre></div>
指令乱序/循环展开</p>
<ul>
<li>code length increases  </li>
<li>lockstep mechanism  </li>
<li>machine code incompability  </li>
</ul>
<h5 id="superpipeline">Superpipeline<a class="headerlink" href="#superpipeline" title="Permanent link">&para;</a></h5>
<p>IF IS RF EX (DF DS TC) WB</p>
<h3 id="memory-hierarchycache-week4-5">Memory Hierarchy(Cache) Week4 - 5<a class="headerlink" href="#memory-hierarchycache-week4-5" title="Permanent link">&para;</a></h3>
<h4 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h4>
<ul>
<li>Registers  </li>
<li>Cache  </li>
<li>Memory  </li>
<li>
<p>Storage  </p>
</li>
<li>
<p>Mechanical memory  </p>
</li>
<li>Electronic memory<br />
  SRAM:static random access memory(Cache)
  DRAM:dynamic ~(Main memory)
    DDR2(double data rate上升沿和下降沿都能传数据),DDR3,DDRSDRAM
  Flash
  ROM:read-only memory
    PROM,EPROM</li>
<li>Optical memory</li>
</ul>
<p>Temporal/Spatial locality时空局部性  </p>
<p>Cache:a safe place for hiding or storing things.  </p>
<p>hit/miss:whether the processor can or cannot find a requested data in the cache<br />
hit rate/miss rate/hit time/miss penalty  </p>
<p>Block run:A fixed-size collection of data containing the data we need retrieved from the memory<br />
Spatial locality:likely need other data within the same block soon  </p>
<h4 id="technology-trend">Technology Trend<a class="headerlink" href="#technology-trend" title="Permanent link">&para;</a></h4>
<p>SRAM
DRAM
SDRAM(Synchronous DRAM)
DDR SDRAM
HBM:High Bandwidth Memory DRAM
SSD
HDD/TAPE</p>
<h4 id="memory-hierarchy">Memory Hierarchy<a class="headerlink" href="#memory-hierarchy" title="Permanent link">&para;</a></h4>
<h5 id="cache-miss">Cache Miss<a class="headerlink" href="#cache-miss" title="Permanent link">&para;</a></h5>
<p>Latency:the time to retrieve the first word of the book<br />
Bandwidth:the time to retrieve the rest of the book  </p>
<p>Miss causes  </p>
<ul>
<li>Compulsory:first reference(cache is empty)  </li>
<li>Capacity:blocks discarded and later retrieved  </li>
<li>Conflict:program makes repeated references to multiple addresses from different blocks that map to the same location in the cache  </li>
</ul>
<p>desktop users:average latency<br />
server:memory bandwidth(multiple users)<br />
embedded:power and battery life/real-time response/small memory  </p>
<p>Everything is a cache.<br />
Registers -&gt; L1-Cache -&gt; L2-Cache -&gt; Memory -&gt; Disk  </p>
<p>Cache Size = Block Size * Sets + Related info(Indexes)</p>
<h4 id="cache-design">Cache Design<a class="headerlink" href="#cache-design" title="Permanent link">&para;</a></h4>
<p>Using a FSM to control a simple cache<br />
next-state function determines the state transition<br />
<img alt="alt text" src="../image-11.png" /><br />
write through写直达:write back to both cache and memory</p>
<h5 id="1where-can-a-block-be-placed-in-the-upper-levelblock-placement">1.Where can a block be placed in the upper level?(Block placement)<a class="headerlink" href="#1where-can-a-block-be-placed-in-the-upper-levelblock-placement" title="Permanent link">&para;</a></h5>
<h6 id="direct-mapped">Direct mapped<a class="headerlink" href="#direct-mapped" title="Permanent link">&para;</a></h6>
<p>(Block address) modulo (Number of blocks in the cache):循环分配<br />
e.g.Cache number = 8(0-7) <br />
Memory 1,9,17,25 -&gt; Cache 1<br />
[Problem]low space usage &amp; high conflict probability  </p>
<h6 id="fully-associative">Fully associative<a class="headerlink" href="#fully-associative" title="Permanent link">&para;</a></h6>
<p>Block can go anywhere in cache  </p>
<h6 id="n-way-set-associative">n-way Set associative<a class="headerlink" href="#n-way-set-associative" title="Permanent link">&para;</a></h6>
<p>Each memory block maps to a cache group(n cache blocks in each group) and put memory block into certain cache block in casual<br />
for most caches:n &lt;= 4</p>
<h5 id="2how-is-a-block-found-if-it-is-in-the-upper-levelblock-identification">2.How is a block found if it is in the upper level?(Block Identification)<a class="headerlink" href="#2how-is-a-block-found-if-it-is-in-the-upper-levelblock-identification" title="Permanent link">&para;</a></h5>
<p>Every block has an address tag that stores the main memory address of the data stored in the block 
valid bit<br />
index selects the set/block
direct map:tag + set index + offset<br />
hit if valid_bit == 1'b1 &amp;&amp; tag == mem_addr  </p>
<h5 id="cache-size-calculation">Cache Size calculation<a class="headerlink" href="#cache-size-calculation" title="Permanent link">&para;</a></h5>
<p><img alt="alt text" src="../image-13.png" /><br />
The size of the block is One word(4 bytes)<br />
64-bit addresses<br />
2<sup>n</sup>blocks(n bits for the index)<br />
block size = 2<sup>m</sup>words<br />
tag = 64-(n+m+Byteoffset) = 64 - (10 + 0 + 2) = 52<br />
Byteoffset = log<sub>2</sub>block size(in bytes) = 2<br />
cache size = 2<sup>n</sup> * (block size + tag size + valid size) = 2<sup>10</sup> * (2<sup>0</sup> * 32(bits/word) + 52 + 1) = 85Kib.  </p>
<p>E.g.How many total bits are required for a direct-mapped cache with 16KiB of data and four-word blocks,assuming a 64-bit address?
ANS:16KiB = 4096words = 2<sup>12</sup>words<br />
block size is 4 words = 2<sup>2</sup>words,m=2<br />
2<sup>12</sup>/2<sup>2</sup> = 1024blocks,n=10<br />
data = 4 * 32(bits/word) = 128 bits(16Bytes * 8)<br />
tag = 64-(n+m+2) = 50 bits<br />
note:64-bit address = 50-bit tag + 10-bit index + 2-bit word offset + 2-bit Byte offset 映射到缓存块<br />
Cache Size = 2<sup>n</sup>*(block size + tag size + valid size)
= 2<sup>10</sup> * (128 + 50 + 1) = 179Kib = 22.375KiB</p>
<p>E.g.Consider a cache with 64 blocks and a block size of 16 bytes. To what block number does byte address 1201 map?<br />
1201 / 16 = 75(1200-1215 in the same block)<br />
75 modulo 64 = 11  </p>
<h5 id="3which-block-should-be-replaced-on-a-cachemain-memory-missblock-replacement">3.Which block should be replaced on a cache/main memory miss?(Block Replacement)<a class="headerlink" href="#3which-block-should-be-replaced-on-a-cachemain-memory-missblock-replacement" title="Permanent link">&para;</a></h5>
<p>No selection is needed for direct map<br />
Handle cache miss:<br />
1.send PC to memory(PC - 4)<br />
2.main memory perform and wait<br />
3.write the cache entry<br />
4.restart inst execution(refetch)<br />
In set-associative and fully-associative,N blocks to choose for replacement.  </p>
<h6 id="random">Random<a class="headerlink" href="#random" title="Permanent link">&para;</a></h6>
<h6 id="lru">LRU<a class="headerlink" href="#lru" title="Permanent link">&para;</a></h6>
<p>Least-Recently Used(LRU):assumed more recently accessed blocks more likely to be referenced again<br />
use extra bits to keep track of accesses</p>
<h6 id="fifo">FIFO<a class="headerlink" href="#fifo" title="Permanent link">&para;</a></h6>
<p>First In,First Out(FIFO)  </p>
<h6 id="optin-theory">OPT(In theory)<a class="headerlink" href="#optin-theory" title="Permanent link">&para;</a></h6>
<p>Replace the one with the latest use in the future<br />
Thrashing:Loop access sequence causes no hit for FIFO/LRU<br />
<strong>Block Size</strong> affects the performance greatly  </p>
<h6 id="stack-replacement-algorithm">Stack replacement algorithm<a class="headerlink" href="#stack-replacement-algorithm" title="Permanent link">&para;</a></h6>
<p>B<sub>t</sub>(n) represents the set of access sequences contained in a cache block of size n at time t.<br />
B<sub>t</sub>(n) is the subset of B<sub>t</sub>(n+1).<br />
<strong>LRU</strong> is a stack replacement algorithm.<br />
<strong>FIFO</strong> is <strong>not</strong> a stack replacement algorithm.(Belady)<br />
Least-Recently Used is pushed to the bottom of the stack<br />
<img alt="alt text" src="../image-12.png" />  </p>
<h6 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h6>
<p>Comparison pair flip-flop<br />
e.g.three cache blocks(A,B,C)<br />
take pair AB,AC,BC<br />
T<sub>AB</sub>:A is accessed later than B<br />
T<sub>AB</sub>,T<sub>AC</sub>,T<sub>BC</sub> represents the sequence of access by applying triggers and gates<br />
<strong>huge block number</strong>:Layered comparison  </p>
<h5 id="4what-happens-on-a-writewrite-strategy">4.What happens on a write?(Write Strategy)<a class="headerlink" href="#4what-happens-on-a-writewrite-strategy" title="Permanent link">&para;</a></h5>
<p>When data is written into the cache,is the data also written to main memory?<br />
Write Through  </p>
<ul>
<li>can always discard cached data  </li>
<li>only a valid bit  </li>
<li>memory always have the latest data  </li>
</ul>
<p>Write Back</p>
<ul>
<li>can't discard  </li>
<li>valid bit and dirty bit(cache与memory不一致)  </li>
<li>much lower bandwidth</li>
</ul>
<p><strong>Write hit</strong>
write buffer(write through)
<strong>Write miss</strong></p>
<ul>
<li>write allocate
  block is loaded into the cache(write back)  </li>
<li>write around
  block is only written to main memory(not stored in the cache) </li>
</ul>
<p><strong>Read allocate</strong>
memory -&gt; cache<br />
read from cache
<strong>Read through</strong><br />
E.g.Assume a fully-associative write-back cache(empty)<br />
What are the number of hits and misses using no-write allocate vs. write allocate?<br />
<strong>no-write allocate</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="c1">;  //miss ,not write to cache</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="c1">;  //miss ,not write to cache</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nf">read</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="c1">;   //miss ,read into cache</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="c1">;  //hit</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="c1">;  //miss ,not write to cache</span>
</code></pre></div>
<strong>write allocate</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="c1">;  //miss write to cache</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="c1">;  //hit</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nf">read</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="c1">;   //miss ,read into cache</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="c1">;  //hit</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nf">write</span><span class="w"> </span><span class="no">Mem</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="c1">;  //hit</span>
</code></pre></div></p>
<h4 id="virtual-memory">Virtual Memory<a class="headerlink" href="#virtual-memory" title="Permanent link">&para;</a></h4>
<p><img alt="alt text" src="../image-14.png" /></p>
<h4 id="memory-system-performance">Memory System Performance<a class="headerlink" href="#memory-system-performance" title="Permanent link">&para;</a></h4>
<p>Memory Stall<br />
Average Memory Access Time(AMAT)
<span class="arithmatex">\(AMAT = (HitTime + MissRate * MissPenalty)\)</span>
E.g.Impact on performance  </p>
<h4 id="cpu-vulnerability">*CPU Vulnerability<a class="headerlink" href="#cpu-vulnerability" title="Permanent link">&para;</a></h4>
<h5 id="meltdown">Meltdown<a class="headerlink" href="#meltdown" title="Permanent link">&para;</a></h5>
<p>利用Intel CPU乱序执行，利用内存响应时间越界访问  </p>
<h5 id="spectre">Spectre<a class="headerlink" href="#spectre" title="Permanent link">&para;</a></h5>
<p>利用Cache预取指令获取私密信息  </p>
<h3 id="cache-optimization-presentation-week-6">Cache Optimization presentation Week 6<a class="headerlink" href="#cache-optimization-presentation-week-6" title="Permanent link">&para;</a></h3>
<h2 id="os">OS<a class="headerlink" href="#os" title="Permanent link">&para;</a></h2>
<h3 id="main-memory-week7-10">Main Memory Week7 - 10<a class="headerlink" href="#main-memory-week7-10" title="Permanent link">&para;</a></h3>
<h4 id="partition">Partition<a class="headerlink" href="#partition" title="Permanent link">&para;</a></h4>
<p>using physical memory<br />
multi-programming:partition<br />
protection,fast-execution,fast context switch<br />
Once process starts,partition cannot be moved<br />
Solution:logical address(offset within the partition相对地址)<br />
Simple implementation:base and limit(length) registers(privileged)<br />
between base and base + limit:segmentation<br />
limit check for protection  </p>
<ul>
<li>built-in protection  </li>
<li>fast execution(hardware)  </li>
<li>fast context switch(only change base and limit)  </li>
<li>norelocation of program address  </li>
<li>partition can be suspended and moved at any time  </li>
</ul>
<h5 id="memory-allocation-strategy">Memory allocation strategy<a class="headerlink" href="#memory-allocation-strategy" title="Permanent link">&para;</a></h5>
<p><strong>fixed</strong>  <br />
same size causing <strong>Internal Fragmentation</strong>(分配的用不完)<br />
<strong>variable</strong>
<strong>External Fragmentation</strong>(有空process但放不进)<br />
first-fit,best-fit,worst-fit  </p>
<h4 id="segmentation">Segmentation<a class="headerlink" href="#segmentation" title="Permanent link">&para;</a></h4>
<p>.text,.data,... have different authority,can they be put into the same partition?  <br />
No,we map one process to n partitions(each is called a segmentation)<br />
[Problem] Insufficient base and limit registers<br />
[Solution] Segment table:an array where each entry has base and limit and perm(permission)<br />
Every process has a segment table<br />
Only a base register is needed to point to the segment table<br />
Every entry represents a segmentation<br />
logical address now is a pair:<segment_number,offset><br />
<img alt="alt text" src="../image-15.png" /><br />
limit can be changed,therefore it is a variable allocation,no internal fragmentation but <strong>external fragmentation</strong><br />
Segmentation is used effectively in Unix(before paging because of small amount of additional hardware)<br />
<strong>address binding</strong><br />
source code(symbolic) -&gt; compiler(relocatable) -&gt; linker(absolute)<br />
Memory-Management Unit(MMU):a translator from logical addr to physical addr  </p>
<h4 id="paging">Paging<a class="headerlink" href="#paging" title="Permanent link">&para;</a></h4>
<p>basic idea:cut the process,making it noncontiguous(avoids external segmentation)<br />
divide <strong>physical</strong> addr into fixed-sized blocks called <strong>frames</strong>(帧)<br />
divide <strong>logical</strong>(virtual) addr into blocks of same size called <strong>pages</strong><br />
Set up a mapping to translate logical to physical addr,this mapping is called <strong>page table</strong>(index page,value frame)(not stored in the pages)<br />
<strong>Internal fragmentation</strong><br />
fixed length partition<br />
page size:2048,program size:72766(35 pages + 1086bytes)<br />
internal fragementation = 2048 - 1086 = 962<br />
Nowadays,the page size is getting bigger because we allow waste in memory(memory is cheaper)<br />
frame table:which frame is free,how many frames have been allocated,... helps OS manage physical address<br />
logical addr = <Page_number(p),Page_offset(d)><br />
m-n bits for page_number,n bits for page_offset<br />
m = 32 or 64,n = log<sub>2</sub>(page_size)<br />
x86:2<sup>32</sup> = 4GB  </p>
<h5 id="implementation_1">Implementation<a class="headerlink" href="#implementation_1" title="Permanent link">&para;</a></h5>
<p>Page-table base register(PTBR),Page-table length register(PTLR)<br />
[Problem] Access page table to find frame number needs one memory access while actually read the data in memory needs another memory access<br />
[Solution] cache the translation to avoid one memory access(TLB:Translation Look-aside Buffer)<br />
hardware implementation:associative memory<br />
tag TLB entries with address-space identifier(ASID)that uniquely identifies a process when context-switch<br />
Associative memory supports parallel search<br />
<img alt="alt text" src="../image-16.png" /><br />
<strong>Effective Access Time</strong>
EAT = hit_ratio * memory_access_time + (1 - hit_ratio) * 2 * memory_access_time<br />
In modern design,hit_ratio is approximately 99.9%<br />
Increase the page size helps improve the hit ratio(memory_access_size = TLB_size * page_size)<br />
<strong>Memory Protection</strong><br />
present(valid) bit and permission bits in page table<br />
<strong>Page Sharing</strong><br />
Run a program multiple times:.text can be shared but .data cannot be shared  </p>
<h5 id="structure">Structure<a class="headerlink" href="#structure" title="Permanent link">&para;</a></h5>
<p>[Question] 32-bit logical address space &amp; 4KB page size,what is the page table size?<br />
4GB/4KB = 1M entries(page table lines)<br />
1M * 4B = 4MB(must be physically contiguous because another table needed for mapping if page table is splited)<br />
If we have 1K processes,simply page tables occupies the whole memory<br />
[Insights] Many indices are invalid<br />
[Solution] break down page table into pages<br />
Page size is 4KB,how many entries can fit in one page?<br />
one entry is 4B,thus we have 1K entries/page  <br />
1M entries can be broken down to 1K pages,indexed by 1K entries,put into another page(4KB)<br />
<img alt="alt text" src="../image-17.png" /><br />
[Advantages] Pages don't need to be contiguous,and no page allocated if invalid in the first level<br />
logical addr = <page_directory_number(first_level),page_table_number(second_level),offset>
12-bits offset:4K(Page size)(stored in the last-level pages)<br />
10-bits page_directory_number and 10-bits page_table_number:1K entries per table<br />
If page size is 64KB,we have 16-bits offset,14-bits page_table_number and 2-bits page_directory_number<br />
Page Table in Linux:page table base register CR3(arm:TTBR,RISCV:SATP,x86:PDBR)(store <strong>physical addr</strong>,otherwise another table for mapping is needed)
64-bit logical address space:16EB(4G * 4GB)<br />
Page table entry:8B page table size:4KB<br />
Entry number/page = 512<br />
3-level page:12 + 9*3 = 39bits(512GB Phone)<br />
4-level page:48bits(256TB Server)<br />
5-level page:57bits(128PB AI)<br />
PTE,PMD,PUD(upper),P4D,PGD(global directory)  </p>
<h5 id="hashed-page-table">Hashed page table<a class="headerlink" href="#hashed-page-table" title="Permanent link">&para;</a></h5>
<p>virtual page number is hashed into frame number<br />
using linked list if two page number has the same hash value<br />
high collision probability &amp; need contiguous addr  </p>
<h5 id="inverted-page-table">Inverted page table<a class="headerlink" href="#inverted-page-table" title="Permanent link">&para;</a></h5>
<p>[Insights] physical addr space &lt;&lt; virtual addr space<br />
[Solution] index by physical addr<br />
Each entry has a pid and virtual page number<br />
need traverse the whole page table &amp; no memory sharing  </p>
<h5 id="swapping">Swapping<a class="headerlink" href="#swapping" title="Permanent link">&para;</a></h5>
<p>[Definition] extends physical memory with backing disks(用硬盘换内存)<br />
Context switch becomes veryvery slow<br />
Swapping is unfriendly to SSD/flash memory<br />
Android terminates apps if low free memory<br />
Intel IA-32 Page Address Extensions(PAE):page table entries to 64bits,but 2-bits for a 4 entry table<br />
Intel IA-64 6 segmentations<br />
ARM:no segmentations  </p>
<h5 id="practice">Practice<a class="headerlink" href="#practice" title="Permanent link">&para;</a></h5>
<p><img alt="alt text" src="../image-18.png" /><br />
1)4GB/4KB = 1M entries,1M * 4B = 4MB<br />
2)1ST:4KB,2ND:1K * 4KB = 4MB<br />
3)Pages don't need to be contiguous,and no page allocated if invalid in the first level<br />
4)10-bits page_directory_number,10-bits page_table_number,12-bits offset<br />
0xf2015202 = 0b1111001000|0000010101|001000000010(968,21)<br />
<img alt="alt text" src="../image-20.png" /><br />
32-bits:2+14+16<br />
39-bit VA:10+13+16(减少一级)<br />
48-bit VA:6+13+13+16<br />
<img alt="alt text" src="../image-19.png" /><br />
offset:log<sub>2</sub>(page_size) = 10
page_number:32-10 = 22
0x00003986:0b0000000000000000001110|0110000110<br />
page_number:14 invalid<br />
0x00002bc6:0b0000000000000000001010|1111000110<br />
page_number:10 offset:0x000003c6<br />
addr = 0x13 &lt;&lt; 10 + 0x000003c6(低10位)  </p>
<h4 id="virtual-memory_1">Virtual Memory<a class="headerlink" href="#virtual-memory_1" title="Permanent link">&para;</a></h4>
<p>[Insights]Code needs to be loaded to memory in execution,but the entire program is rarely needed at the same time<br />
[Solution]partially-loaded program<br />
demand paging:brings a page into physical memory only when accessed<br />
lasy swap:never swap a page unless accessed<br />
pre-paging:predict pages may be accessed later<br />
invalid -&gt; page fault  </p>
<h5 id="page-fault">Page fault<a class="headerlink" href="#page-fault" title="Permanent link">&para;</a></h5>
<p>(1)invalid reference -&gt; exception<br />
(2)valid reference but not in memory -&gt; swap in<br />
page fault handling  </p>
<ul>
<li>get an empty physical frame  </li>
<li>swap page into frame via disk operation(maintained by free-frame list)  </li>
<li>set page table entry to indicate the page in memory  </li>
<li>restart the instruction  </li>
</ul>
<p>tell OS to map by <code>syscall</code>(brk,mmap),not actually allocation until demand<br />
<img alt="alt text" src="../image-22.png" /><br />
<img alt="alt text" src="../image-23.png" /><br />
allocate free frames using <strong>zero-fill-on-demand</strong><br />
<img alt="alt text" src="../image-21.png" /><br />
EAT:page fault rate:p<br />
EAT = (1-p) * memory access time + p * (page fault overhead + swap out + swap in + instruction restart overhead)<br />
Copy-on-Write(COW):allows the parent and child processes(fork()) to initially share the same pages in memory as long as no process modify(write) it.<br />
If either process writes the COW page,OS copies the page and set the page writable<br />
Page replacement:no free page when needed<br />
[Solution] swap out some pages to swap分区<br />
[Question] How to select victim page to avoid thrashing?<br />
Dirty bit:whether the page is modified after loaded?<br />
We can directly replace the pages if not dirty<br />
page fault handling with replacement  </p>
<ul>
<li>find the location of the desired page on disk  </li>
<li>find the free page<br />
  if there is a free page,use it<br />
  if there is none,pick a victim frame
    if the frame's dirty,write to the disk  </li>
<li>update the page table  </li>
<li>restart the instruction  </li>
</ul>
<p>potentially <strong>2 page I/O</strong> for one page fault<br />
Page replacement algorithm:FIFO,optimal,LRU,LFU,MFU<br />
For FIFO,adding more frames may cause more page faults(Belady's anomaly)(not stack replacement)<br />
(Enhanced) Second-Chance Algorithm:take order pair(reference,modify(dirty))(0,0 &gt; 0,1 &gt; 1,0 &gt; 1,1)<br />
Page-Buffering Algorithm:always keep a pool of free frames  </p>
<h5 id="allocation">Allocation<a class="headerlink" href="#allocation" title="Permanent link">&para;</a></h5>
<p>Fixed(Local) allocation per process<br />
Global allocation<br />
Reclaiming pages<br />
memory below minimum threshold:choose process to kill according to OOM scores<br />
Major page fault:page is referenced but not in memory<br />
Minor pape fault:mapping does not exist,but page in memory<br />
  shared library<br />
  reclaimed and not freed yet<br />
Non-Uniform Memory Access(NUMA):speed of access to memory varies(multi-core and multi-core-correspond-memory)<br />
allocating memory "close to" the CPU by scheduler  </p>
<h5 id="thrashing">Thrashing<a class="headerlink" href="#thrashing" title="Permanent link">&para;</a></h5>
<p>[Definition] a process does not have enough pages,causing higher page fault rate,page fault to get page,existing existing frame,but quickly need replaced frame back,thereby <strong>a process is busy swapping pages in and out</strong><br />
Why does thrashing occur?total size of locality &gt; total memory size<br />
[Solution] 
1.using local or priority page replacement(one process thrashing does not affect others)<br />
2.provide a process with as many frames as it needs<br />
<strong>Working-set Model</strong><br />
Working-set window(Δ):a fixed number of page references
working set of process p<sub>i</sub>(WSS<sub>i</sub>):total number of pages referenced in the most recent Δ<br />
total working sets:D = ΣWSS<sub>i</sub>,monitor the total working set by suspending and swapping out to make D &lt; m<br />
[Challenge] keep track of the working set<br />
[Solution] page-fault frequency(PFF) to check the pressure of process memory,swap out a process is PFF is too high  </p>
<h5 id="kernel-memory-allocation">Kernel Memory Allocation<a class="headerlink" href="#kernel-memory-allocation" title="Permanent link">&para;</a></h5>
<p>allocated from a free-memory pool<br />
for device I/O,kernel memory needs to be physically contiguous<br />
<strong>Buddy System</strong>:memory is allocated in units of the size of power of 2<br />
split the unit into two buddies until a proper sized chunk is available<br />
E.g.256KB is available,21KB is requested<br />
256KB -&gt; 128KB -&gt; 64KB -&gt; 32KB = 21KB_round_up<br />
<strong>Slab Allocator</strong>:a slab contains one or more pages,divided into equal-sized objects<br />
a cache in a slab allocator consists of one or more slabs<br />
fast small kernel object allocation and small internal fragmentation,object fields may be reusable,no need to initialize again<br />
<img alt="alt text" src="../image-24.png" /><br />
kmem_cache -&gt; slabs_full/partial/empty -&gt; slab -&gt; page -&gt; object<br />
<code>kmalloc()</code> -&gt; small object using slab/huge object using buddy system:ensuring contiguous PA<br />
<code>vmalloc()</code>(similar to <code>malloc()</code> in user space):huge space requirement but no need contiguous PA   </p>
<h5 id="other-considerations">Other considerations<a class="headerlink" href="#other-considerations" title="Permanent link">&para;</a></h5>
<p><strong>Prepaging</strong>
<strong>Page Size</strong>(and reason)  </p>
<ul>
<li>Fragmentation:small page size  </li>
<li>Page table size:large  </li>
<li>Number of page faults:large  </li>
<li>TLB(page table entry cache) size:large</li>
<li>Locality:small  </li>
<li>I/O overhead:large(every page fault needs an I/O)  </li>
<li>always a power of 2  </li>
<li>growing over time  </li>
</ul>
<p><strong>TLB Reach</strong>:the amount of memory accessible from the TLB<br />
TLB Reach = TLB size * page size<br />
<strong>Program structure</strong><br />
int[128,128],each row is stored in one page,and only one entry in the TLB<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">128</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="mi">128</span><span class="o">*</span><span class="mi">128</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16384</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">faults</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">128</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="mi">128</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">faults</span>
</code></pre></div>
<strong>I/O interlock</strong>:pages that are used for copying a file from a device must be locked from being selected for eviction  </p>
<h4 id="free-space-management">*Free Space Management<a class="headerlink" href="#free-space-management" title="Permanent link">&para;</a></h4>
<p>In virtual memory space,<br />
[Mechanism] splitting and coalescing(合并)<br />
<img alt="alt text" src="../image-25.png" /><br />
<img alt="alt text" src="../image-26.png" /><br />
[Problem] the storage of the linked list<br />
[Solution] reuse the freed space  <br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">__header_t</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="p">}</span><span class="w"> </span><span class="n">header_t</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">__node_t</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">__node_t</span><span class="o">*</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="p">}</span><span class="w"> </span><span class="n">node_t</span><span class="p">;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="kt">void</span><span class="w"> </span><span class="nf">free</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">  </span><span class="n">header_t</span><span class="w"> </span><span class="o">*</span><span class="n">hptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">header_t</span><span class="p">);</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="p">}</span>
</code></pre></div>
<img alt="alt text" src="../image-27.png" />
16500:a space addr pointer
[Question] What is 16500 does not point correctly,e.g.,16508(where size and magic can be cotrolled by user)堆喷  </p>
<p><a href="notebook/docs/sp25/sys3/virtual_memory_quiz.pdf">Virtual_Memory_Quiz(2024final)</a>  </p>
<details class="success">
<summary>answer</summary>
<p>CDAC</p>
<p>a.VA 15 = 10(VPN) + 5(OFFSET)<br />
  PA 12 = 7(PFN) + 5(OFFSET)  </p>
<p>b.Virtual Address 0x17f5:0b00101(pde index)|11111(pte index)|10101(PA offset)<br />
pde content from PDBR(108),pte content from pde content(84)<br />
Value:0x1c from pte content &amp; PA offset(78,21)<br />
PA:0b1001110(78),0b10101(21)-&gt;0b100111010101-&gt;0x9d5  </p>
</details>
<h3 id="file-system-week10-12">File System Week10 - 12<a class="headerlink" href="#file-system-week10-12" title="Permanent link">&para;</a></h3>
<h4 id="file-system-interface">File System Interface<a class="headerlink" href="#file-system-interface" title="Permanent link">&para;</a></h4>
<p>[Definition] file is a contiguous logical addr space for storing info<br />
proc file system - use file system <strong>interface</strong> to retrieve system info(not real data in storage),an alterative of syscalls,using read,open and write<br />
File attributes:name,identifier(tag),type,location,size,protection(permission,e.g.777,access control list(ACL)),time/user identification,checksum,...<br />
File operations:</p>
<ul>
<li>create:space for file allocated;entry allocated in the directory  </li>
<li>open:return a handler for other operations<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,...);</span><span class="c1">//file descriptor</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1">//per process mapping[fd,file]</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,...);</span>
</code></pre></div></li>
<li>read/write:maintain a pointer  </li>
<li>seek:reposition the pointer within the file  </li>
<li>delete:release space,hardlink(delete a file until all the pointers relate to it are deleted),truncate(delete a file but maintains its attributes)  </li>
<li>copy:create and read/write  </li>
</ul>
<p>Open files:<strong>open-file table</strong>(info about all opened files,per-process(position,access right;differ in processes) &amp; system-wide(location on disk))<br />
Info:file position(per-process),file-open count,disk location,access right<br />
*lock:shared lock &amp; exclusive lock<br />
file types:magic number(.exe,.o,.c,.txt,...)  </p>
<h4 id="file-structure">File structure<a class="headerlink" href="#file-structure" title="Permanent link">&para;</a></h4>
<ul>
<li>no structure:linux  </li>
<li>simple record structure:database  </li>
<li>complex structure:word document,relocatable program file  </li>
</ul>
<p>Access methods:<br />
sequential access:tape<br />
direct access(random access):access an element of arbitary position in (roughly) equal time<br />
other method:multiple layers of index points to blocks  </p>
<ul>
<li>directory structure:a collection of nodes containing info about all files  </li>
<li>disk structure:subdivided into partitions(分区),each volume(partition) tracks file system info in the volume's table<br />
  raw disks(no partition,no file system):preferred in database  </li>
</ul>
<p>Directory operations  </p>
<ul>
<li>create
  LinkAT FileName,INode  </li>
<li>delete  </li>
<li>list  </li>
<li>search  </li>
<li>group(locally group files by properties,e.g. all java project)  </li>
</ul>
<h5 id="single-level-directory">Single-Level Directory<a class="headerlink" href="#single-level-directory" title="Permanent link">&para;</a></h5>
<p>A single directory for all users<br />
[Problem]<br />
two users can't have same file name<br />
hard to group files  </p>
<h5 id="two-level-directory">Two-Level Directory<a class="headerlink" href="#two-level-directory" title="Permanent link">&para;</a></h5>
<p>Separate directory for each user<br />
<img alt="alt text" src="../image-28.png" /><br />
[Problem]<br />
no file sharing  </p>
<h5 id="tree-structured-directory">Tree-Structured Directory<a class="headerlink" href="#tree-structured-directory" title="Permanent link">&para;</a></h5>
<p><img alt="alt text" src="../image-29.png" /><br />
efficient searching,grouping and naming<br />
File can be accessed using <strong>absolute</strong> or <strong>relative</strong> path name<br />
absolute path name: /home/alice/..<br />
relative path(<code>pwd</code>):<current_directory>/...
Delete:<br />
Option I:<code>rm</code> directory cannot delete unless it's empty<br />
Option II:<code>rm -rf</code> delete all files,directories and sub-directories  </p>
<h5 id="acyclic-graph-directory">Acyclic-Graph Directory<a class="headerlink" href="#acyclic-graph-directory" title="Permanent link">&para;</a></h5>
<p>allow links to a directory entry/files for aliasing(renaming)<br />
<img alt="alt text" src="../image-30.png" /><br />
[Problem] Dangling pointer(悬挂指针)<br />
Delete /dict/all,then /dict/w/list &amp; /spell/words are dangling pointers<br />
[Solution]<br />
backpointer:record all the pointers to the entry<br />
reference counter:count # of links to it,only delete when counter = 0<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">//dangling pointers</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">ptr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">null</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="c1">//ptr1 is a dangling pointer</span>
</code></pre></div>
[Advantage] Shared files<br />
<img alt="alt text" src="../image-31.png" /><br />
metadata in <code>inode</code><br />
link:多个文件路径指向同一文件<br />
hardlink:多个文件名指向同一个<code>inode</code><br />
softlink(symbolic link):datablock存放真正link的路径(快捷方式)<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>/home/
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span>file
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span>file1
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span>file2
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>Directory:Name<span class="w">  </span>inode
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">          </span>file<span class="w">  </span><span class="m">500</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">          </span>file1<span class="w"> </span><span class="m">500</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">          </span>file2<span class="w"> </span><span class="m">501</span><span class="w"> </span>block#1000<span class="o">(</span>/home/file<span class="o">)</span>
</code></pre></div>
<code>file1</code> automatically removed if <code>rm /home/file</code><br />
softlink need multiple searches and may cause broken link(linked file not exist)<br />
hardlink deletes the datablock only when the links are all deleted<br />
softlink can link files cross-filesystem<br />
<strong>cycles in graph structure</strong><br />
garbage collection &amp; cycle detection algorithm  </p>
<h5 id="mounting">Mounting<a class="headerlink" href="#mounting" title="Permanent link">&para;</a></h5>
<p>A file system must be mounted(挂载) before it can be accessed,e.g.插入U盘<br />
a mounted file system makes the old directory at the mount point invisible  </p>
<h5 id="file-sharing">File Sharing<a class="headerlink" href="#file-sharing" title="Permanent link">&para;</a></h5>
<p>protection by user ID &amp; group ID<br />
NFS(Network File System)  </p>
<h4 id="acl">ACL<a class="headerlink" href="#acl" title="Permanent link">&para;</a></h4>
<p>ACL(Access Control List)<br />
fine-grained control(精细控制防止过度授权) but list management is a big deal<br />
<strong>UNIX Access Control</strong><br />
默认没有设置ACL但是支持<br />
user types:owner(RWX),group(RW),others(X)<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>chmod<span class="w"> </span><span class="m">761</span><span class="w"> </span>game
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1"># 7 for owner,6 for group,1 for others</span>
</code></pre></div>
<strong>fork()</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;./file.txt&quot;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">);</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">SEEK_SET</span><span class="p">);</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">rc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child: fd %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">fd</span><span class="p">);</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">SEEK_SET</span><span class="p">);</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child: offset %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">rc</span><span class="p">);</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;parent: fd %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">fd</span><span class="p">);</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;parent: offset %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">SEEK_CUR</span><span class="p">));</span><span class="c1">//5?</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">    </span><span class="c1">//10 actually</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="p">}</span>
</code></pre></div>
Per-process access table but not a deep copy for file descriptors(they point to the same handle)<br />
<img alt="alt text" src="../image-32.png" /><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">rc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="c1">//file descriptor leak</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;./file.txt&quot;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">);</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="cm">/*</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="cm">    a good way is to close parent process&#39; file descriptor </span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="cm">    before operations in child</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="cm">    /*</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="cm">    ...</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="cm">  }</span>
</code></pre></div></p>
<h4 id="file-and-directory">File and Directory<a class="headerlink" href="#file-and-directory" title="Permanent link">&para;</a></h4>
<p>File:linear array of bytes,each has an inode number<br />
Directory:a list of user-readable name to inode number mapping,each entry points to file or other directory<br />
<strong>create</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="n">O_CREAT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_TRUNC</span><span class="p">);</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="cm">/*</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="cm">O_CREAT:create if not exists</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="cm">O_WRONLY:can only write</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="cm">O_TRUNC:truncate it to zero bytes if the file exists</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="cm">*/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nb">echo</span><span class="w"> </span>hello<span class="w"> </span>&gt;<span class="w"> </span>foo
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>cat<span class="w"> </span>foo
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1"># hello</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>strace<span class="w"> </span>cat<span class="w"> </span>foo<span class="w"> </span><span class="c1">#查看系统调用 open(&quot;foo&quot;,O_RDONLY) = 3</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1"># read(3,&quot;hello\n&quot;,131072) = 6</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="c1"># write(1,&quot;hello\n&quot;,6hello) = 6 </span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1"># read(3,&quot;,131072) = 0</span>
</code></pre></div>
<strong>seek</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kt">off_t</span><span class="w"> </span><span class="nf">lseek</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fildes</span><span class="p">,</span><span class="w"> </span><span class="kt">off_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">whence</span><span class="p">);</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="cm">/*</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="cm">whence == SEEK_SET,offset = offset_bytes</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="cm">whence == SEEK_CUR,offset = current_location + offset_bytes</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="cm">whence == SEEK_END,offset = size_of_file + offset_bytes</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="cm">*/</span>
</code></pre></div>
<strong>write</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="n">O_CREAT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_TRUNC</span><span class="p">);</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">assert</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">buffer</span><span class="p">,</span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="n">rc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fsync</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="c1">//forces all dirty data to disk</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="n">assert</span><span class="p">(</span><span class="n">rc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<strong>stat</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">stat</span><span class="w"> </span><span class="n">foo</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1">// File: &#39;foo&#39;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c1">// Size: 6 Blocks: 8 IO Block: 4096 ...</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1">// ...</span>
</code></pre></div>
<strong>remove</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>strace<span class="w"> </span>rm<span class="w"> </span>foo
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1"># unlinkat(AT_FDCWD, &quot;foo&quot;, 0) = 0</span>
</code></pre></div>
<code>rm</code>:unlink the file and check the Reference count of the inode<br />
free the inode until the reference count == 0<br />
<strong>mkdir</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>strace<span class="w"> </span>mkdir<span class="w"> </span>foo
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="c1"># mkdir(&quot;foo&quot;, 0777) = 0</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>ls<span class="w"> </span>-al
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="c1"># drwxrwxr-x 2 os os 4096 &lt;time&gt; .</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="c1"># drwxrwxr-x 3 os os 4096 &lt;time&gt; ..</span>
</code></pre></div>
Empty directory has two entries('.' for current,'..' for upper level)<br />
<strong>read directory</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="kt">DIR</span><span class="w"> </span><span class="o">*</span><span class="n">dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opendir</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">dp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">dirent</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="k">while</span><span class="p">((</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readdir</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">d_ino</span><span class="p">,</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">  </span><span class="n">closedir</span><span class="p">(</span><span class="n">dp</span><span class="p">);</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="p">}</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="cm">/*</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="cm">struct dirent {</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="cm">  char d_name[256];</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="cm">  ino_t d_ino;</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="cm">  off_t d_off;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="cm">  ...</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="cm">}</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="cm">*/</span>
</code></pre></div>
<strong>link</strong><br />
<code>link()</code> system call:takes two arguments,an old pathname and a new one<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>ln<span class="w"> </span>file<span class="w"> </span>file2<span class="w"> </span><span class="c1"># link(hardlink)</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>ls<span class="w"> </span>-i<span class="w"> </span>file<span class="w"> </span>file2
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="c1"># same inode number</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nb">echo</span><span class="w"> </span>hello<span class="w"> </span>&gt;<span class="w"> </span>file
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>ln<span class="w"> </span>-s<span class="w"> </span>file<span class="w"> </span>file2<span class="w"> </span><span class="c1"># Symbolic link(softlink)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="c1"># filepath in datablock of file2  </span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>rm<span class="w"> </span>file
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>cat<span class="w"> </span>file2
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="c1"># No such file or directory  </span>
</code></pre></div>
<strong>TOCTTOU</strong><br />
*Time of Check to Time of Use
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">access</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">W_OK</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">//check</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="c1">//schedule ?</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="c1">//symlink(&quot;/etc/password&quot;,&quot;file&quot;);</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="p">);</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span><span class="w"> </span><span class="c1">//use</span>
</code></pre></div>
<code>O_NOFOLLOW</code>:fail if pathname is symbolic link  </p>
<h4 id="file-system-implementation">File System Implementation<a class="headerlink" href="#file-system-implementation" title="Permanent link">&para;</a></h4>
<p>File system resides on secondary storage(disks)<br />
disk driver provides interface to read/write disk blocks<br />
file system provides user interface to storage,mapping logical to physical<br />
file control block(inode)  </p>
<h5 id="layered-file-system">Layered File System<a class="headerlink" href="#layered-file-system" title="Permanent link">&para;</a></h5>
<p>0.I/O control--device drivers<br />
1.basic file system<br />
2.file-organization module<br />
3.logical file system</p>
<h5 id="implementation_2">Implementation<a class="headerlink" href="#implementation_2" title="Permanent link">&para;</a></h5>
<p><strong>on-disk structure</strong>(storage)  </p>
<ul>
<li>file control block:perm,dates,ACL,size,data block/pointer to data block(same data inside and other data stored in other place and pointed by a pointer)  </li>
<li>boot control block:contains info to boot OS(per volume)  </li>
<li>volume control block(superblock):volume details,including total block number,block size,free blocks &amp; pointers,free FCB &amp; pointers(per volume)<br />
  FCB count is fixed when formatting the disk for high efficiency<br />
  expand if FCB is full  </li>
<li>directory structure(per file system)  </li>
</ul>
<p><strong>in-memory structure</strong>(access)  </p>
<ul>
<li>mount table  </li>
<li>in-memory directory structure cache  </li>
<li>system-wide open-file table:copy of FCB  </li>
<li>per-process open-file table:pointers to entries in system-wide open-file table and other info  </li>
<li>I/O memory buffers  </li>
</ul>
<p><strong>creation</strong><br />
1.FCB allocation<br />
2.link inode &amp; name
3.directory update<br />
In UNIX,directories are treated equally as files,which is different from Windows<br />
<strong>open</strong><br />
1.search system-wide open-file table:already opened?<br />
  It it is,create a per-process open-file table pointing to the existing system-wide open-file table<br />
  If not,search the directory for the file name,place the FCB in system-wide open-file table once found<br />
2.make an entry in per-process open-file table with pointers to the entry in the system-wide open-file table(FCB in system-wide)<br />
3.increment the open count in the system-wide open-file table<br />
4.return a pointer <code>fd</code> to the entry in per-process open-file table<br />
<strong>close</strong><br />
1.remove per-process open-file entry<br />
2.decrement open count<br />
3.all processes close file -&gt; copy info to disk,remove system-wide open-file table<br />
<img alt="alt text" src="../image-33.png" /><br />
<img alt="alt text" src="../image-34.png" /><br />
<strong>mount</strong><br />
Boot block:series of sequential blocks containing bootloader<br />
In-memory mount table:mount points,type of file system mounted,access path,(UNIX)a pointer to the superblock(global metadata,fixed location on disk)<br />
<strong>Virtual File System</strong><br />
VFS:an object-oriented way for implementing file systems<br />
VFS object types:superblock,inode,dentry(associates name to inode),file<br />
<strong>Directory</strong><br />
Linear list of file names;hash table(faster search but collsion)  </p>
<h5 id="disk-block-allocation">Disk Block Allocation<a class="headerlink" href="#disk-block-allocation" title="Permanent link">&para;</a></h5>
<ul>
<li>contiguous allocation:best performance in most cases,simple to implement<br />
  not flexible:file size hard to change,causing external fragmentation<br />
  extent-based contiguous allocation:extent is a set of contiguous blocks but extents are not necessarily adjacent  </li>
<li>linked:each file is a linked list of disk blocks<br />
  blocks can be scattered,no external fragmentation<br />
  many I/Os and seeks for locating<br />
  Improvement:cluster the blocks,but causing internal fragmentation  </li>
<li>indexed:each file has its index blocks of pointers to its data blocks<br />
  random access avaliable,no external fragmentation<br />
  but storing index requires space,a waste for small files<br />
  index block allocation:multiple-level<br />
<img alt="alt text" src="../image-35.png" /><br />
<img alt="alt text" src="../image-37.png" /><br />
quiz answer:4TB  </li>
</ul>
<h5 id="free-space-management_1">Free Space Management<a class="headerlink" href="#free-space-management_1" title="Permanent link">&para;</a></h5>
<ul>
<li>Bitmap:one bit for each block,but require extra space for bitmap storage  </li>
<li>Linked list:no waste of space but difficult for getting contiguous space<br />
  note:usually no need to traverse the list  </li>
<li>Grouping:use indexes to group free blocks<br />
  store addr of n-1 free blocks in the first free block and a pointer to next index block  </li>
<li>Counting:a link of clusters  </li>
</ul>
<h5 id="file-system-performance">File System Performance<a class="headerlink" href="#file-system-performance" title="Permanent link">&para;</a></h5>
<p>• disk allocation and directory algorithms<br />
• types of data kept in file’s directory entry<br />
• pre-allocation or as-needed allocation of metadata structures<br />
• fixed-size or varying-size data structures<br />
Performance Improvement:<br />
1.keep data and metadata close together,because every operation to data operates metadata<br />
2.use cache<br />
Page cache:caches pages for MMIO(Memory-mapped I/O(fd -&gt; VA))<br />
<img alt="alt text" src="../image-36.png" /><br />
unified buffer cache uses the same page cache to cache both memory-mapped pages and disk I/O to avoid double caching<br />
3.use asynchronous writes:buffered or cached,periodically/fsync() to disk<br />
4.optimize sequential access<br />
free behind:remove the previous page from the buffer<br />
read-ahead:read multiple pages ahead<br />
<strong>Read often slower than write</strong> because of asynchronous writes,no asynchronous read  </p>
<h5 id="recovery">Recovery<a class="headerlink" href="#recovery" title="Permanent link">&para;</a></h5>
<p>1.backup<br />
2.Log structured file systems:metadata for updates sequentially written to a <strong>circular log</strong>,then commit to write to disk,recommit if failed<br />
only ensure the consistency,not guarantee that data will not be lost  </p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<p>Assume we have 64 blocks,each block size 4K<br />
56/64 for data<br />
5/64 for inode(suppose inode are 256bytes,4Kb block can hold 16 inodes),80 files<br />
1/64 for bitmap for free inodes<br />
1/64 for bitmap for free data regions<br />
1/64 for superblock:info about the file system(inode block number,data block number,inode table begin addr,data region begin addr &amp; a magic number)<br />
<img alt="alt text" src="../image-38.png" /><br />
inode_number addr = inode_number * sizeof(inode) + 4k(superblock) + 8k(bitmap)  </p>
<h5 id="directory-organization">Directory organization<a class="headerlink" href="#directory-organization" title="Permanent link">&para;</a></h5>
<p>a mapping of inode &amp; name,strlen(length of name),reclen(ROUNDUP(strlen))<br />
<img alt="alt text" src="../image-39.png" /><br />
给定相对路径，按绝对路径读<br />
write in open() for updating time,etc in inode<br />
First search system-wide open-file table.If found,we don't need to find the file<br />
After opening the file,put the entry into the per-process open-file table<br />
<img alt="alt text" src="../image-40.png" />  </p>
<h4 id="crash-consistency">*Crash Consistency<a class="headerlink" href="#crash-consistency" title="Permanent link">&para;</a></h4>
<p>Crash scenarios:write inode,bitmap &amp; data block<br />
[Case1] Only data block is written<br />
[Case2] Only inode is written(inode points to garbage):inconsistency between inode and bitmap<br />
[Case3] Only bitmap is written:a space leak<br />
[Case4] inode &amp; bitmap written:block has garbage data<br />
[Case5] inode &amp; data block<br />
[Case6] bitmap &amp; data block:data belonging unknown<br />
[Solution1] checker<br />
[Solution2] journaling(writing ahead logging)<br />
1.write inode,bitmap &amp; data to log(a.k.a journal)<br />
2.Transaction begin(TxB) -&gt; Transaction end(TxE)<br />
3.After the transaction is safely on the disk,overwrite the old data(checkpointing)<br />
checkpoint:write from log to disk
<img alt="alt text" src="../image-41.png" /><br />
crash when writing to journal<br />
[Solution1] issue one operation at a time<br />
[Solution2] split write to two steps<br />
<strong>Recovery</strong><br />
[Case1] crash when writing to log<br />
no TxE,data lost but no inconsistency<br />
[Case2] after transaction committed but before checkpoint<br />
redo logging<br />
[Case3] during checkpointing<br />
redo<br />
Journal structure:circular<br />
[Problem] writing each data block twice<br />
[Solution] Metadata journaling<br />
[Option1] write data after the transaction finishes<br />
[Option2] write the data block first(no garbage pointer)<br />
<img alt="alt text" src="../image-97.png" /><br />
<img alt="alt text" src="../image-42.png" /><br />
quiz answer:unlink("/m");creat("/z");mkdir();</p>
<h3 id="mass-storage-week13">Mass Storage Week13<a class="headerlink" href="#mass-storage-week13" title="Permanent link">&para;</a></h3>
<p>See [databaseChap12]<br />
sector,track,cylinder<br />
<img alt="alt text" src="../image-51.png" />  </p>
<h4 id="magnetic-disk">Magnetic Disk<a class="headerlink" href="#magnetic-disk" title="Permanent link">&para;</a></h4>
<p>positioning time(random-access time) = seek time + rotational latency<br />
performance:transfer rate(Gb/sec)<br />
average access time = average seek time + average latency<br />
average I/O time = average access time + (data to transer/transfer rate) + controller overhead  </p>
<h4 id="non-volatile-memory-devices">Non-volatile memory devices<a class="headerlink" href="#non-volatile-memory-devices" title="Permanent link">&para;</a></h4>
<p>solid-state disk(SSDs) more reliable than HDDs<br />
1.read and written in pages increment but can't overwrite in place(must be erased)<br />
2.can only be erased a limited number of times<br />
3.lifespan measured by drive writes per day(DWPD)<br />
<strong>NAND Flash Controller Algorithm</strong><br />
flash translation layer(FTL) table<br />
garbage collection:free invalid page space<br />
<img alt="alt text" src="../image-52.png" />  </p>
<h4 id="disk-attachment">Disk Attachment<a class="headerlink" href="#disk-attachment" title="Permanent link">&para;</a></h4>
<ul>
<li>host-attached storage:hard disk,RAID,CD,DVD,tape,...
  using I/O bus    </li>
<li>network-attached storage(NAS)<br />
  over TCP/UDP on IP network  </li>
<li>storage area network(SAN)<br />
  high speed interconnection and efficient protocols(than TCP/IP)  </li>
</ul>
<h4 id="disk-scheduling">Disk scheduling<a class="headerlink" href="#disk-scheduling" title="Permanent link">&para;</a></h4>
<h5 id="fcfs">FCFS<a class="headerlink" href="#fcfs" title="Permanent link">&para;</a></h5>
<p><img alt="alt text" src="../image-43.png" />  </p>
<h5 id="sstf">SSTF<a class="headerlink" href="#sstf" title="Permanent link">&para;</a></h5>
<p>shortest seek time first(not optimal,compare to SJF),starvation exists<br />
<img alt="alt text" src="../image-44.png" />  </p>
<h5 id="scanelevator">SCAN(Elevator)<a class="headerlink" href="#scanelevator" title="Permanent link">&para;</a></h5>
<p><img alt="alt text" src="../image-45.png" />  </p>
<h5 id="c-scan">C-SCAN<a class="headerlink" href="#c-scan" title="Permanent link">&para;</a></h5>
<p>Circular-SCAN
<img alt="alt text" src="../image-46.png" />  </p>
<h5 id="lookc-look">LOOK/C-LOOK<a class="headerlink" href="#lookc-look" title="Permanent link">&para;</a></h5>
<p><img alt="alt text" src="../image-47.png" />  </p>
<h4 id="disk-management">Disk Management<a class="headerlink" href="#disk-management" title="Permanent link">&para;</a></h4>
<p>Physical formatting:divide disk into sectors<br />
Logical formatting:OS partition disk into groups of cylinders,each treated as a logical disk<br />
root partition:only contains the OS,mounted at boot time<br />
boot block:point to bootloader(codes of how to load kernel)<br />
<strong>swap space management</strong><br />
扩展物理内存(DRAM),暂存不活跃的page用于交换<br />
Swap partition交换分区  </p>
<h5 id="raid">RAID<a class="headerlink" href="#raid" title="Permanent link">&para;</a></h5>
<p>Redundant array of inexpensive disks<br />
RAID 0:split evenly on two or more disks<br />
<img alt="alt text" src="../image-54.png" /><br />
RAID 1:exact copy/mirror<br />
<img alt="alt text" src="../image-55.png" /><br />
RAID 2:stripe data at the bit-level,use Hamming code<br />
RAID 4:block-level striping with a dedicated parity disk<br />
RAID 5:block-level striping with parity data distributed across all disks<br />
RAID 6:adding additional parity block<br />
detect/recover from disk failures,does not prevent or detect data corruption<br />
ZFS adds additional checks(checksum) to detect errors  </p>
<h3 id="io-week13-14">I/O Week13 - 14<a class="headerlink" href="#io-week13-14" title="Permanent link">&para;</a></h3>
<h4 id="io-hardware">I/O hardware<a class="headerlink" href="#io-hardware" title="Permanent link">&para;</a></h4>
<p>I/O devices:storage,communication,human-interface<br />
bus:interconnection<br />
port:device connection part<br />
controller<br />
access by polling(CPU周期性检查,very high network load,busy-wait) or interrupt(from I/O,context switch)<br />
direct I/O Instruction:<code>In/Out &lt;Device.no&gt;</code>(x86)<br />
MMIO:VA Space -&gt; I/O device  </p>
<h4 id="interrupts">Interrupts<a class="headerlink" href="#interrupts" title="Permanent link">&para;</a></h4>
<p>[type] protection error(invalid access),page fault,system calls<br />
Multi-CPU can process interrupts concurrently,even use a CPU to handle interrupts dedicatedly,CPU affinity(lock on global data if accessed by multiple cores)<br />
APIC(Advanced programming interrupt controller)  </p>
<h4 id="dma">DMA<a class="headerlink" href="#dma" title="Permanent link">&para;</a></h4>
<p>[Definition] Direct Memory Access:transfer data directly between I/O &amp; memory(bypass the CPU) using DMA controller <strong>in the device</strong><br />
[Problem] Device may change physical address directly<br />
[Solution] IOMMU:Device address -&gt; Physical address<br />
[Problem] IOMMU can only control page size granularity<br />
<img alt="alt text" src="../image-48.png" /><br />
<img alt="alt text" src="../image-49.png" />  </p>
<h4 id="io-devices">I/O Devices<a class="headerlink" href="#io-devices" title="Permanent link">&para;</a></h4>
<p>character-stream:sequential,block:random-access(read,write,seek),memory-mapped file access,network socket<br />
direct manipulation(操作) of I/O device is not allowed(e.g. 监听password)  </p>
<ul>
<li>Synchronous I/O<br />
  blocking:process suspended until I/O completed<br />
  non-blocking:I/O return as much data as avaliable,use select to find data if ready then use read or write to transfer data  </li>
<li>Asynchronous I/O:process runs while I/O executes,I/O signals process when completed(data already in buffer,<code>read()</code> not needed)  </li>
</ul>
<h4 id="kernel-io-subsystem">Kernel I/O Subsystem<a class="headerlink" href="#kernel-io-subsystem" title="Permanent link">&para;</a></h4>
<p>scheduling:queue I/O requests via per-device queue<br />
buffering:store data in memory while transferring between devices because of speed unmatch,device transfer size unmatch or maintain copy semantics(e.g,<code>write(fd,buf,...)</code>)<br />
cache:hold a copy of data for fast access<br />
spooling:hold output 打印机<br />
device reservation:exclusive access to device<br />
name to device representation:major/minor(编号) in UNIX  </p>
<h5 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h5>
<p>recover by retrying or advanced handling<br />
return error code  </p>
<h5 id="io-protection">I/O Protection<a class="headerlink" href="#io-protection" title="Permanent link">&para;</a></h5>
<p>direct I/O Instruction:define all I/O instructions to be privileged<br />
MMIO:security check in MMU(user mode cannot access I/O VA)<br />
<img alt="alt text" src="../image-50.png" />  </p>
<h4 id="performance">Performance<a class="headerlink" href="#performance" title="Permanent link">&para;</a></h4>
<p>[Improvement] reduce context switches,reduce data copying,reduce interrupts by using large transfers,small controllers,polling,use DMA,smarter hardware,move user-mode processes to kernel threads(reduce context switches and essures non-blocking)<br />
<code>sendfile()</code>,SG-DMA copy<br />
zero-copy in practice:2 context switch + 2 DMA copy (no CPU copy)<br />
<img alt="alt text" src="../image-53.png" />  </p>
<h4 id="page-cache">Page Cache<a class="headerlink" href="#page-cache" title="Permanent link">&para;</a></h4>
<p>in memory,before read from disk<br />
not work for big file(data written in cache but never read)<br />
<a href="notebook/docs/sp25/sys3/file_system_quiz.pdf">File_System_Quiz</a></p>
<h2 id="_2">体系结构<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="dlptlp-week14-15">DLP,TLP Week14 - 15<a class="headerlink" href="#dlptlp-week14-15" title="Permanent link">&para;</a></h3>
<h4 id="simdvector-processor">SIMD:Vector processor<a class="headerlink" href="#simdvector-processor" title="Permanent link">&para;</a></h4>
<p>SIMD:single instruction multiple data 单指令流多数据流<br />
<span class="arithmatex">\(D = A * (B + C)\)</span>,A,B,C,D are vectors of length N<br />
1.horizontal processing method<br />
<span class="arithmatex">\(d_i = a_i * (b_i + c_i)\)</span><br />
data related:N times,function switching:2N times(static pipeline needs drain排空)<br />
2.vertical processing method<br />
<span class="arithmatex">\(K = B + C\)</span><br />
<span class="arithmatex">\(D = A * K\)</span><br />
data related:1 time,function switching:2 times<br />
[Problem] what if N is very big;multiplication has to wait for all add operations complete<br />
3.vertical and horizontal(grouping) processing method<br />
N is very big,each group can put <em>n</em> instructions<br />
N = s * n + r<br />
data related:s+1 times,function switching:2(s+1) times  </p>
<h5 id="cray-1">CRAY-1<a class="headerlink" href="#cray-1" title="Permanent link">&para;</a></h5>
<p>64 instructions per group,12 single-function pipeline<br />
Vi conflict<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nf">V0</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V1</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">V2</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nf">V3</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V0</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="no">V4</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="nf">V0</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V1</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">V2</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="nf">V3</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V1</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="no">V4</span><span class="w"> </span><span class="c1"># V1 may not be entirely stored in memory  </span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="nf">V3</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V1</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="no">V2</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="nf">V5</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V4</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="no">V6</span><span class="w"> </span><span class="c1"># hardware conflict</span>
</code></pre></div>
instruction types:  </p>
<ul>
<li>Vk = Vi op Vj  </li>
<li>Vk = Si op Vj  </li>
<li>Vk &lt;- Memory  </li>
<li>Memory &lt;- Vi  </li>
<li>Memory:6 beats  </li>
<li>Add:6 beats  </li>
<li>Multiply:7 beats  </li>
<li>Every data transfer:1 beat  </li>
</ul>
<h5 id="performance-improvement">Performance improvement<a class="headerlink" href="#performance-improvement" title="Permanent link">&para;</a></h5>
<p>1.multiple functional units<br />
2.vector chaining technology向量链接<br />
<span class="arithmatex">\(D = A * (B + C)\)</span>,N &lt;= 64<br />
V0 = B,V1 = C<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nf">V3</span><span class="w"> </span><span class="err">&lt;</span><span class="p">-</span><span class="w"> </span><span class="no">memory</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nf">V2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V0</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">V1</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="nf">V4</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">V2</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="no">V3</span><span class="w"> </span><span class="c1"># RAW but no functional/hardware conflict,using chaining!</span>
</code></pre></div>
<img alt="alt text" src="../image-57.png" /><br />
once the first output of V4 come out,every clock cycle another output of V4 come out<br />
<img alt="alt text" src="../image-56.png" /><br />
(1)((1 + 6 + 1) + N - 1) + ((1 + 6 + 1) + N - 1) + ((1 + 7 + 1) + N - 1) = 3N + 22<br />
(2)((1 + 6 + 1) + N - 1) + ((1 + 7 + 1) + N - 1) = 2N + 15<br />
(3)(1 + 6 + 1) + (1 + 7 + 1) + N - 1 = N + 16<br />
3.Segmented vector<br />
4.Multi-processor system<br />
RISC-V(scalar) -&gt; RV64V  </p>
<h4 id="array-processor">Array Processor阵列机<a class="headerlink" href="#array-processor" title="Permanent link">&para;</a></h4>
<p>Distributed memory:each processor has its own memory(ICN,dynamic network connecting the processors)<br />
Centralized shared memory:N processors and K memories interconnect by ICN<br />
[Question] connection path:direct or indirect<br />
interconnection network:static or dynamic<br />
[Goal] any two PEs can achieve info transfer in a few steps<br />
single-stage/multi-stage interconnection network  </p>
<h5 id="single-state-interconnection-network">Single-state interconnection network<a class="headerlink" href="#single-state-interconnection-network" title="Permanent link">&para;</a></h5>
<p><strong>Cube</strong>:N inputs and outputs are encoded with n-bit(<span class="arithmatex">\(n = log_2N\)</span>) binary code <span class="arithmatex">\(P_{n-1}...P_i...P_1P_0\)</span><br />
<span class="arithmatex">\(Cube_i(P_{n-1}...P_i...P_1P_0) = P_{n-1}...\overline{P_i}...P_1P_0\)</span><br />
<img alt="alt text" src="../image-58.png" /><br />
The 3D cube can transfer data between any two processing elements at most 3 times<br />
if N is bigger,then we have at most <span class="arithmatex">\(log_2N\)</span> times(hyper cube)<br />
<strong>PM2I</strong>(Plus Minus <span class="arithmatex">\(2^i\)</span>):<span class="arithmatex">\(PM2_{+i}(j) = (j + 2^i)mod N\)</span>,<span class="arithmatex">\(PM2_{-i}(j) = (j - 2^i)mod N\)</span>,2n functions,2n-1 different functions(i = n - 1)<br />
transfer data between any two processing elements at most n - 1 times<br />
<strong>Shuffle exchange</strong><br />
<span class="arithmatex">\(shuffle(P_{n-1}...P_i...P_1P_0) = P_{n-2}...P_{i-1}...P_1P_0P_{n-1}\)</span><br />
exchange:<span class="arithmatex">\(Cube_0\)</span><br />
<img alt="alt text" src="../image-59.png" /><br />
If N is bigger,from all '0' to all '1', we need n shuffles and n - 1 exchanges<br />
<strong>Other static networks</strong>  </p>
<ul>
<li>Linear array  </li>
<li>Circular array  </li>
<li>Loop with chord array<br />
<img alt="alt text" src="../image-60.png" />  </li>
<li>Tree array<br />
  tree with loop,binary fat tree<br />
<img alt="alt text" src="../image-61.png" />  </li>
<li>Star array  </li>
<li>Grid:格  </li>
<li>2D torus<br />
<img alt="alt text" src="../image-62.png" />  </li>
<li>Hypercube  </li>
<li>Cube with loop<br />
<img alt="alt text" src="../image-63.png" />  </li>
</ul>
<h5 id="network-charactistics">Network Charactistics<a class="headerlink" href="#network-charactistics" title="Permanent link">&para;</a></h5>
<p>Dynamic networks  </p>
<ul>
<li>buses:time-division characteristics,only one pair of nodes are transmitting data at the same time  </li>
<li>crossbar switches<br />
<img alt="alt text" src="../image-64.png" />  </li>
<li>multi-stage interconnection network(Switch unit:m input and m output switches)<br />
<img alt="alt text" src="../image-66.png" /><br />
  switch function<br />
  switch control method<br />
  topology  </li>
</ul>
<p><strong>cube</strong><br />
<img alt="alt text" src="../image-67.png" /><br />
Each switch can be chosen direct connection or exchange connection,8 different connections in total<br />
<img alt="alt text" src="../image-68.png" /><br />
hint:the binary representation of connect/exchange corresponds to the function<br />
Example:
<img alt="alt text" src="../image-73.png" />  </p>
<div class="admonition practice">
<p class="admonition-title">Practice</p>
</div>
<p><img alt="alt text" src="../image-70.png" /><br />
<strong>shuffle</strong><br />
Multi-level shuffle exchange network(a.k.a Omega network)  </p>
<ul>
<li>switch function has 4 functions  </li>
<li>topological structure is inverse to the cube structure<br />
<img alt="alt text" src="../image-71.png" /><br />
<img alt="alt text" src="../image-72.png" />  </li>
</ul>
<p><img alt="alt text" src="../image-76.png" />  </p>
<h4 id="dlp-in-gpu">DLP in GPU<a class="headerlink" href="#dlp-in-gpu" title="Permanent link">&para;</a></h4>
<p>SIMD exploit parallelism for:matrix,media<br />
Graphical Processing Unit(GPU)<br />
heterogenous(异源) execution model<br />
forms of GPU parallelism:CUDA(Compute Unified Device Architecture) thread<br />
Single instruction multiple thread<br />
Multithreaded SIMD processors:SIMT<br />
<img alt="alt text" src="../image-77.png" /><br />
GPU memory is shared by all grids<br />
Local memory is shared by all threads of SIMD instructions within a thread block<br />
Private memory is private to a single CUDA Thread<br />
<img alt="alt text" src="../image-78.png" />  </p>
<h4 id="llp">LLP<a class="headerlink" href="#llp" title="Permanent link">&para;</a></h4>
<p>LLP:Loop-Level Parallelism<br />
Loop-carried dependence:<strong>focuses on determining whether data accesses in later iterations are dependent on data values produced in eariler iterations</strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">999</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="c1">//no loop-carried dependencence  </span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">  </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">  </span><span class="c1">//S1-&gt;S1</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span><span class="c1">//S1-&gt;S2,S2-&gt;S2</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">  </span><span class="c1">//loop-carried dependence</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="p">}</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">  </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">  </span><span class="c1">//S1</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">  </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="c1">//S2</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">  </span><span class="c1">//S1 uses value computed by S2 in previous iteration</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">  </span><span class="c1">//S2 in i-1 -&gt; S1 in i</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">  </span><span class="c1">//but dependence is not circular,S2 can be done in parallel</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="p">}</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="c1">//rewrite to erase loop-carried dependence</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">  </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">];</span><span class="w"> </span><span class="c1">//生产者</span>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">  </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">     </span><span class="c1">//消费者</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">  </span><span class="c1">//data access depends on the value produced in the same iteration</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">  </span><span class="c1">//no loop-carried dependence</span>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="p">}</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="n">B</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="mi">99</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="mi">99</span><span class="p">];</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="c1">//name dependence</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">  </span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="c1">//RAW</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">  </span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="p">}</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="c1">//rewrite:</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w">  </span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w">  </span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w">  </span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">  </span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="p">}</span>
</code></pre></div>
!!! TODO:practice
<img alt="alt text" src="../image-79.png" />  </p>
<h4 id="mimdthread-level-parallelism">MIMD:Thread-level Parallelism<a class="headerlink" href="#mimdthread-level-parallelism" title="Permanent link">&para;</a></h4>
<p>MIMD:multiple instructions multiple data
multi-processor:shared memory<br />
multi-computer:message passing<br />
NORMA(no-remote memory access)<br />
<img alt="alt text" src="../image-80.png" />  </p>
<h5 id="uniform-memory-accessuma">Uniform-Memory Access(UMA)<a class="headerlink" href="#uniform-memory-accessuma" title="Permanent link">&para;</a></h5>
<p>集中共享，紧耦合的共享资源，a.k.a SMP(Symmetiric(Shared-memory) Multi-Processors)<br />
<img alt="alt text" src="../image-81.png" /><br />
each CPU owns its cache and small private memory  </p>
<h5 id="non-uniform-memory-accessnuma">Non-Uniform-Memory Access(NUMA)<a class="headerlink" href="#non-uniform-memory-accessnuma" title="Permanent link">&para;</a></h5>
<p>分布式，a.k.a DSP(Distributed Shared-memory Processors)<br />
<img alt="alt text" src="../image-82.png" /><br />
NC-NUMA:Non-Cache Non-Uniform Memory Access<br />
CC-NUMA:Coherent Cache Non-Uniform Memory Access  </p>
<h5 id="cache-only-memory-accesscoma">Cache-Only Memory Access(COMA)<a class="headerlink" href="#cache-only-memory-accesscoma" title="Permanent link">&para;</a></h5>
<p><img alt="alt text" src="../image-83.png" /><br />
COMA is a special case of NUMA<br />
Coherent Cache by applying cache-coherence protocol  </p>
<h5 id="massively-parallel-processorsmpp">Massively Parallel Processors(MPP)<a class="headerlink" href="#massively-parallel-processorsmpp" title="Permanent link">&para;</a></h5>
<p>Multiple processors(standard <strong>CPUs</strong>) connected by custom network<br />
<img alt="alt text" src="../image-84.png" />  </p>
<h5 id="clusters-of-workstationscow">Clusters of Workstations(COW)<a class="headerlink" href="#clusters-of-workstationscow" title="Permanent link">&para;</a></h5>
<p>a large number of <strong>PCs</strong> or workstations connected by commercial network<br />
<img alt="alt text" src="../image-85.png" />  </p>
<h4 id="performance-evalutation">Performance evalutation<a class="headerlink" href="#performance-evalutation" title="Permanent link">&para;</a></h4>
<p>hurdle:limited parallelism avaliable in programs,relatively high cost of communications<br />
Recall Amdahl's Law:<br />
<span class="arithmatex">\(Speedup_{overall} = \frac{Execution\ time_{old}}{Execution\ time_{new}}= \frac{1}{(1-Fraction_{enhanced}) + \frac{Fraction_{enhanced}}{SpeedUp_{enhanced}}}\)</span><br />
<img alt="alt text" src="../image-86.png" /><br />
<img alt="alt text" src="../image-87.png" /><br />
<img alt="alt text" src="../image-88.png" />  </p>
<h4 id="cache-coherence">Cache Coherence<a class="headerlink" href="#cache-coherence" title="Permanent link">&para;</a></h4>
<p>An example  </p>
<table>
<thead>
<tr>
<th>time</th>
<th>event</th>
<th>cacheA</th>
<th>cacheB</th>
<th>memory</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td></td>
<td></td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>Aread</td>
<td>0</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Bread</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Astore</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>memory consistency:a processor writes location A followed by B,any processor that sees the new value of B must also see the new value of A读写顺序<br />
using <strong>memory consistency model</strong><br />
relaxed consistency model:allows out-of-order execution,using synchronization<br />
R-&gt;W,R-&gt;R are often relaxed<br />
cache coherence:all reads by any processor must return the most recently written value,writes to the same location by any two processors are seen in the same order by all processors<br />
causing by migration &amp; replication<br />
using <strong>cache coherence protocol</strong>  </p>
<h5 id="bus-snooping-protocoluma">Bus snooping protocol(UMA)<a class="headerlink" href="#bus-snooping-protocoluma" title="Permanent link">&para;</a></h5>
<p>监听:broadcast invalid info/update data on the bus to invalidate/update other copies<br />
write through &amp; write back<br />
write invalidate protocol(using write back)<br />
|processor|buss|cacheA|cacheB|memory|
|-------|-------|-------|-------|-------|
|||||0|
|Aread|cache miss|0||0|
|Bread|cache miss|0|0|0|
|Awrite|invalidation|1|X|0|
|Bread|cache miss|1|1|1|</p>
<p><strong>MSI protocol</strong><br />
- Invalid<br />
- Shared<br />
- Modified(Exclusive)  </p>
<p><img alt="alt text" src="../image-89.png" /><br />
<img alt="alt text" src="../image-91.png" /><br />
<img alt="alt text" src="../image-92.png" />  </p>
<p>!!! TODO:practice<br />
<img alt="alt text" src="../image-93.png" /><br />
<img alt="alt text" src="../image-94.png" /><br />
<img alt="alt text" src="../image-95.png" /><br />
<img alt="alt text" src="../image-96.png" /><br />
<strong>MESI protocol</strong><br />
exclusive -&gt; shared if read by others<br />
exclusive -&gt; modified if written<br />
True exclusive,no copy in other cores,no invalidation will happen(no broadcast is needed)  </p>
<h5 id="directory-based-protocolnuma">Directory based protocol(NUMA)<a class="headerlink" href="#directory-based-protocolnuma" title="Permanent link">&para;</a></h5>
<p>directory for recording which processors in the system have copies of certain blocks in the cache,sends invalid signal to processors that have copies through the directory when one cache writes  </p>
<h2 id="final-review-week16">Final Review Week16<a class="headerlink" href="#final-review-week16" title="Permanent link">&para;</a></h2>
<h3 id="_3">体系结构<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<h4 id="_4">量化研究方法<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>选择题 CPI,CPU time的计算<br />
Amdahl's Law:计算SpeedUp  </p>
<h4 id="ilp">ILP<a class="headerlink" href="#ilp" title="Permanent link">&para;</a></h4>
<p>Data Dependencies<br />
Name Dependencies<br />
(RAW,WAR,WAW)<br />
Control Dependencies<br />
是否存在冒险的区分  </p>
<h5 id="scoreboard_1">Scoreboard<a class="headerlink" href="#scoreboard_1" title="Permanent link">&para;</a></h5>
<p>ID -&gt; IS(in-order) + RO(out-of-order)  </p>
<h5 id="tomasulo_1">Tomasulo<a class="headerlink" href="#tomasulo_1" title="Permanent link">&para;</a></h5>
<p>Reservation station,command bus  </p>
<h5 id="hardware-based-speculation_1">Hardware-based Speculation<a class="headerlink" href="#hardware-based-speculation_1" title="Permanent link">&para;</a></h5>
<p>using Reorder buffer(ROB) before writing back to registers  </p>
<h4 id="cache">Cache<a class="headerlink" href="#cache" title="Permanent link">&para;</a></h4>
<p>Block placement(fully associative,set associative,direct mapped)<br />
Which one has a lower cache miss rate?<br />
Block identification(tag/block)<br />
Given cache size,associative method,calculate the tag bit number,...(see homework)<br />
Block replacement(Random,LRU,FIFO)<br />
Write strategy(Write Back,Write Through(with write buffer))<br />
What happens if write hit or write miss?(combined with cache coherence protocol)<br />
<span class="arithmatex">\(AMAT = (HitTime + MissRate * MissPenalty)\)</span><br />
给定CPI，MissPenalty，MissRate计算AMAT，CPUTime等  </p>
<h4 id="multiple-issue-static-scheduling">Multiple issue &amp; static scheduling<a class="headerlink" href="#multiple-issue-static-scheduling" title="Permanent link">&para;</a></h4>
<p>选择题，区分Superpipeline,superscalar,VLIW  </p>
<h4 id="dlp">DLP<a class="headerlink" href="#dlp" title="Permanent link">&para;</a></h4>
<p>SIMD<br />
各自的特点</p>
<h5 id="vector-processor">Vector Processor<a class="headerlink" href="#vector-processor" title="Permanent link">&para;</a></h5>
<p>CRAY-1</p>
<h5 id="array-processor_1">Array Processor<a class="headerlink" href="#array-processor_1" title="Permanent link">&para;</a></h5>
<p>interconnect network</p>
<h4 id="tlp">TLP<a class="headerlink" href="#tlp" title="Permanent link">&para;</a></h4>
<p>MIMD<br />
UMA(SMP),NUMA(DSP)区别，适用场景<br />
memory consistency不涉及，只考察与Coherence的区别<br />
MSI protocol(snooping)<br />
状态机<br />
MESI(+Exclusive)  </p>
<h3 id="os_1">OS<a class="headerlink" href="#os_1" title="Permanent link">&para;</a></h3>
<h4 id="main-memory">Main Memory<a class="headerlink" href="#main-memory" title="Permanent link">&para;</a></h4>
<p>Paritition,Segmentation<br />
Fragmentation(internal,external)<br />
Paging to avoid external fragmentation<br />
Address translation<br />
PTBR(page-table base register) contains <strong>physical</strong> address<br />
TLB acceleration:page cache in CPU<br />
Effective Access Time(EAT)<br />
pages must physical contigious<br />
page directory number,page table number,page offset(calculation!)<br />
Hashed page table,inverted page table  </p>
<h5 id="demand-paging">Demand paging<a class="headerlink" href="#demand-paging" title="Permanent link">&para;</a></h5>
<p>Page Fault<br />
Page replacement(FIFO,optimal,LRU,LFU,MFU)<br />
几次缺页</p>
<h5 id="page-size">Page size<a class="headerlink" href="#page-size" title="Permanent link">&para;</a></h5>
<p>TLB reach</p>
<h4 id="mass-storage">Mass Storage<a class="headerlink" href="#mass-storage" title="Permanent link">&para;</a></h4>
<p>Disk scheduling(FCFS,SSTF,SCAN,C-SCAN,C-LOOK)计算各个算法下磁头移动的距离  </p>
<h4 id="io-system">I/O System<a class="headerlink" href="#io-system" title="Permanent link">&para;</a></h4>
<p>Polling &amp; Interrupt  </p>
<h4 id="file-system">File System<a class="headerlink" href="#file-system" title="Permanent link">&para;</a></h4>
<p>File attributes
Open files(per-process table,system-wide table)<br />
Directory:link&amp;unlink 
Protection:permission(ACL,Unix)  </p>
<h5 id="file-system-implementation_1">File System Implementation<a class="headerlink" href="#file-system-implementation_1" title="Permanent link">&para;</a></h5>
<p>FCB(file metadata)<br />
note:file name is stored in directory metadata,not FCB!<br />
on-disk structure,directory structure<br />
multi-level pointer(计算max file size)<br />
例：最多读3次(single indirect)<br />
disk block allocation:contiguous,linked-list,indexed  </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © YYC 2025
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://tapir-elithril.github.io/Notebook/" target="_blank" rel="noopener" title="tapir-elithril.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<3230105697@zju.edu.cn>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.top", "navigation.indexes", "navigation.expand", "search.suggest", "search.highlight", "content.code.copy", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/extra.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>